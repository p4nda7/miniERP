<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Intelligentes Kassensystem f√ºr Pizzabestellungen">
    <title>Pizza Kassensystem</title>
    <!-- F√ºge ein Favicon hinzu -->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
    <style>
        /* Farbvariablen nach Feng Shui und Design Thinking Prinzipien */
        :root {
            /* Hauptfarben */
            --wood-green: #4b7b3f;
            --fire-red: #ff3b30;
            --earth-yellow: #f39c12;
            --metal-gray: #34495e;
            --water-blue: #2874a6;
        
            /* Hover-Varianten */
            --wood-green-hover: #3d6433;
            --fire-red-hover: #ff1a1a;
            --earth-yellow-hover: #d68910;
            --metal-gray-hover: #2c3e50;
            --water-blue-hover: #1b4f72;
        
            /* Neue Administrative Farben */
            --admin-purple: #512888; /* Dunkleres Violett */
            --admin-purple-hover: #3a1d64;
            --report-blue: #104e8b; /* Dunkleres Blau */
            --report-blue-hover: #083c6c;
            --danger-red: #a32020; /* Intensiveres Rot */
            --danger-red-hover: #7f1717;
        
            /* Aktualisierte L√∂schbutton-Farbe */
            --delete-red: #a32020;
            --delete-red-hover: #7f1717;
        
            /* Neue Farben f√ºr coole Effekte */
            --hover-shadow: rgba(0, 0, 0, 0.2);
            --hover-scale: 1.05;
        
            /* Farben */
            --primary-color: var(--wood-green);
            --primary-hover: var(--wood-green-hover);
            --secondary-color: var(--water-blue);
            --secondary-hover: var(--water-blue-hover);
            --danger-color: var(--delete-red);
            --danger-hover: var(--delete-red-hover);
            
            /* Abst√§nde */
            --spacing-xs: 5px;
            --spacing-sm: 10px;
            --spacing-md: 15px;
            --spacing-lg: 20px;
            --spacing-xl: 25px;
            
            /* Schatten */
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.12);
            --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.15);
            
            /* Border-Radius */
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            
            /* Transitions */
            --transition-fast: all 0.2s ease;
            --transition-normal: all 0.3s ease;
        }
        
        /* Grundlayout */
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #eef2f7;
            margin: 0;
            padding: 20px;
            color: #495057;
            line-height: 1.6;
        }
        
        .container {
            max-width: 885px; /* 700px + 15% + 10% */
            margin: auto;
            background: #ffffff;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        h1, h2 {
            text-align: center;
            color: #343a40;
            font-weight: 700;
            margin-bottom: 20px;
        }
        
        form label {
            display: block;
            margin: 10px 0 5px;
            font-weight: 600;
            color: #6c757d;
        }
        
        form input, form select, button {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 16px;
            background-color: #f8f9fa;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        
        form input:focus, form select:focus {
            border-color: #007bff;
            box-shadow: 0 0 5px rgba(0, 123, 255, 0.25);
            outline: none;
        }
        
        /* Grundlegende Button-Stile */
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        button:hover {
            transform: scale(var(--hover-scale));
            box-shadow: 0 4px 8px var(--hover-shadow);
        }
        
        /* Prim√§re Buttons (Hauptaktionen) - Holz-Element f√ºr Wachstum */
        .primary-button {
            background-color: var(--wood-green);
        }
        
        .primary-button:hover {
            background-color: var(--wood-green-hover);
        }
        
        /* Sekund√§re Buttons (Nebenaktionen) - Wasser-Element f√ºr Kommunikation */
        .secondary-button {
            background-color: var(--water-blue);
        }
        
        .secondary-button:hover {
            background-color: var(--water-blue-hover);
        }
        
        /* Spezielle Button-Stile */
        #addPosition {
            background-color: var(--earth-yellow);
        }
        
        #addPosition:hover {
            background-color: var(--earth-yellow-hover);
        }
        
        #closeOrder {
            background-color: var(--fire-red);
        }
        
        #closeOrder:hover {
            background-color: var(--fire-red-hover);
        }
        
        #exportJSON {
            background-color: var(--metal-gray);
        }
        
        #exportJSON:hover {
            background-color: var(--metal-gray-hover);
        }
        
        /* Deaktivierte Buttons */
        button:disabled {
            background-color: #bbbbbb;
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .output p {
            font-size: 18px;
            margin: 10px 0;
            color: #495057;
        }
        
        /* Tabellenlayout */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
        }
        
        table th, table td {
            border: 1px solid #dee2e6;
            padding: 12px;
            text-align: left;
            font-size: 14px;
        }
        
        table th {
            background-color: #f1f3f5;
            font-weight: 700;
            text-transform: uppercase;
        }
        
        table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        tfoot tr td {
            font-weight: bold;
            text-align: center;
        }
        
        tfoot tr:nth-child(2) td {
            color: #dc3545;
        }
        
        tfoot tr:nth-child(3) td {
            color: #28a745;
        }
        
        /* Styling f√ºr Buttons */
        button.remove {
            background-color: var(--delete-red);
            color: white;
            font-weight: bold;
            min-width: 32px;
            padding: 6px 12px;
            font-size: 14px;
            box-shadow: 0 2px 4px rgba(213, 0, 0, 0.3);
        }
        
        button.remove:hover {
            background-color: var(--delete-red-hover);
            transform: translateY(-1px);
            box-shadow: 0 3px 6px   rgba(183, 28, 28, 0.4);
        }
        
        /* Rechnungsausgabe Styling - Optimiert und konsistent */
        #invoiceContainer,
        #orderHistoryContainer {
            margin-top: 20px;
            padding: 25px;
            border: 1px solid #d1d9e6;
            border-radius: 12px;
            background: linear-gradient(145deg, #ffffff, #e8edf2);
            box-shadow: 0 4px 15px rgba(52, 73, 94, 0.1);
            overflow-x: auto;
            border-left: 6px solid var(--wood-green);
            transition: all 0.3s ease;
        }
        
        .invoice-content,
        .history-content {
            background: #ffffff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .invoice-header, .invoice-footer,
        .history-header, .history-footer {
            background: linear-gradient(145deg, #f8f9fa, #f0f2f5);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .invoice-header,
        .history-header {
            border-bottom: 2px solid var(--wood-green);
            margin-top: 0;
        }
        
        .invoice-footer,
        .history-footer {
            border-top: 2px solid var(--wood-green);
            margin-bottom: 0;
        }
        
        .invoice-items {
            background-color: #ffffff;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .invoice-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            background-color: #ffffff;
            transition: background-color 0.3s ease;
        }
        
        .invoice-item.header {
            background-color: #e8edf2;
            font-weight: bold;
            border-bottom: 2px solid #dee2e6;
            color: #2c3e50;
        }
        
        .invoice-item.total {
            background-color: #e8edf2;
            font-weight: bold;
            border-top: 2px solid #dee2e6;
            border-bottom: none;
            color: #2c3e50;
        }
        
        .invoice-item:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .invoice-item:hover {
            background-color: #f0f4f8;
        }
        
        .item-details {
            flex: 1;
        }
        
        .item-name {
            font-weight: 600;
            margin-bottom: 4px;
            color: #2c3e50;
        }
        
        .item-info {
            color: #5d6975;
            font-size: 0.9em;
        }
        
        .item-price {
            min-width: 100px;
            text-align: right;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .invoice-footer {
            margin-top: 20px;
            padding: 20px;
            text-align: center;
            background-color: #e8edf2;
            border-radius: 0 0 8px 8px;
            color: #2c3e50;
        }
        
        .invoice-date {
            color: #5d6975;
            font-size: 0.9em;
            margin-top: 10px;
        }
        
        .invoice-thank-you {
            text-align: center;
            font-style: italic;
            color: #5d6975;
            margin-top: 20px;
        }
        
        /* Spezifische Button-Stile */
        .price-management .add-product {
            background-color: var(--earth-yellow);
            color: white;
            width: 100%;
        }
        
        .price-management .save-price {
            background-color: var(--wood-green);
            color: white;
            flex: 1;
        }
        
        .price-management .delete-price {
            background-color: var(--delete-red);
            color: white;
            flex: 1;
        }
        
        /* Hover-Effekte */
        .price-management button:hover {
            transform: translateY(-1px);
            filter: brightness(1.1);
        }
        
        /* Neue Produkt-Zeile Styling */
        .price-management .new-product-name,
        .price-management .new-product-purchase,
        .price-management .new-product-selling {
            border: 2px dashed #ced4da;
            background-color: #fff;
        }
        
        .price-management .new-product-name:focus,
        .price-management .new-product-purchase:focus,
        .price-management .new-product-selling:focus {
            border: 2px solid var(--earth-yellow);
            box-shadow: 0 0 0 3px rgba(243, 156, 18, 0.1);
        }
        
        /* Responsive Anpassungen */
        @media screen and (max-width: 768px) {
            .price-management {
                margin: 10px -15px;
                border-radius: 0;
            }
            
            .price-management table {
                min-width: 500px;
            }
            
            .price-management th,
            .price-management td {
                padding: 6px;
            }
            
            .price-management input {
                padding: 6px;
                font-size: 14px;
            }
            
            .price-management button {
                padding: 6px;
                font-size: 12px;
            }
            
            /* Angepasste Spaltenbreiten f√ºr Mobile */
            .price-management td:nth-child(1) { width: 30%; }
            .price-management td:nth-child(2),
            .price-management td:nth-child(3) { width: 22%; }
            .price-management td:nth-child(4) { width: 26%; }
        }
        
        @media screen and (max-width: 480px) {
            .price-management table {
                min-width: 450px;
            }
            
            .price-management td:last-child {
                min-width: 120px;
            }
            
            .price-management button {
                padding: 6px 4px;
                font-size: 11px;
            }
        }
        
        /* Touch-Optimierungen */
        @media (hover: none) {
            .price-management button,
            .price-management input {
                min-height: 44px;
            }
            
            .price-management td {
                padding: 8px 6px;
            }
        }
        
        /* Druckanpassungen */
        @media print {
            .price-management {
                box-shadow: none;
                overflow: visible;
            }
            
            .price-management button {
                display: none;
            }
            
            .price-management input {
                border: none;
                padding: 0;
            }
        }
        
        .price-management .new-product-name,
        .price-management .new-product-purchase {
            background-color: #fff;
            border: 2px dashed #ced4da;
        }
        
        .price-management .new-product-name:focus,
        .price-management .new-product-purchase:focus {
            border: 2px solid var(--earth-yellow);
            box-shadow: 0 0 0 3px rgba(243, 156, 18, 0.1);
        }
        
        /* Admin Button Styling */
        #showAdmin {
            background-color: var(--admin-purple);
            color: white;
            margin-left: 10px;
        }
        
        #showAdmin:hover {
            background-color: var(--admin-purple-hover);
        }
    
        .search-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
            padding: 20px;
            background-color: #2e84e0; /* Dezente blaue Hintergrundfarbe */
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
    
        .search-box {
            display: flex;
            gap: 10px;
            width: 100%;
            max-width: 600px;
            align-items: center;
        }
    
        .search-input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid var(--wood-green);
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
    
        .search-input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(75, 123, 63, 0.2);
        }
    
        .search-button, .clear-search {
            background-color: var(--wood-green);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
    
        .search-button:hover, .clear-search:hover {
            background-color: var(--wood-green-hover);
            transform: translateY(-1px);
        }
    
        @media (max-width: 768px) {
            .search-box {
                flex-direction: column;
                gap: 10px;
            }
    
            .search-button, .clear-search {
                width: 100%;
            }
        }
    
        .search-results {
            margin-top: 20px;
            padding: 20px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
    
        .customer-summary {
            border-left: 4px solid var(--wood-green);
            padding: 15px;
            margin: 15px 0;
            background: #f8f9fa;
            border-radius: 0 8px 8px 0;
        }
    
        .customer-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(230px, 1fr)); /* 200px + 15% */
            gap: 15px;
            margin: 15px 0;
            padding: 15px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
    
        .stat-item {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
        }
    
        .stat-value {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--wood-green);
        }
    
        .order-history-item {
            margin: 10px 0;
            padding: 15px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: background-color 0.3s ease, transform 0.3s ease;
        }
    
        .order-history-item.unpaid {
            background-color: #ffe0e0;
        }
    
        .order-history-item.paid {
            background-color: #e0ffe0;
        }
    
        .no-results {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
        }
    
        /* Zahlungsbereich in der Suche */
        .payment-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            flex-wrap: wrap;
        }
    
        .payment-input-group label {
            font-weight: 600;
            color: #495057;
            min-width: 140px;
        }
    
        .payment-input-group .payment-amount-input {
            flex: 1;
            min-width: 120px /* Vergr√∂√üert von 100px */;
            padding: 12px 15px /* Vergr√∂√üert von 8px 12px */;
            border: 2px solid var(--wood-green);
            border-radius: 6px;
            font-size: 16px ;/* Vergr√∂√üert von 14px */;
        }
    
        .confirm-payment-button,
        .update-payment-btn {
            background-color: #2c3e50; /* Dunklere Farbe */;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
    
        .confirm-payment-button:hover,
        .update-payment-btn:hover {
            background-color: #1a252f; /* Noch dunklerer Hover-Effekt */;
            transform: translateY(-1px);
        }
    
        /* Responsive Anpassungen */
        @media screen and (max-width: 768px) {
            .payment-input-group {
                flex-direction: column;
                gap: 8px;
            }
    
            .payment-input-group .payment-amount-input {
                width: 100%;
            }
    
            .confirm-payment-button,
            .update-payment-btn {
                width: 100%;
            }
        }
    
        /* Statistik Styling */
        .stats-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 0; /* Entferne den √§u√üeren Margin */;
            width: 100%;
        }
    
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(288px, 1fr)); /* 250px + 15% */;
            gap: 20px;
        }
    
        .stats-card {
            background: linear-gradient(145deg, #ffffff, #e8edf2); /* Dunklerer Gradient */;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.12);
            transition: all 0.3s ease;
            border: 1px solid #d1d9e6; /* Dunklerer Rahmen */;
        }
    
        .stats-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            background: linear-gradient(145deg, #ffffff, #dde4ec); /* Noch dunklerer Hover-Gradient */;
        }
    
        .stats-card h3 {
            margin: 0 0 15px 0;
            color: #2c3e50; /* Dunklere √úberschriftenfarbe */;
            font-size: 1.2em;
            border-bottom: 2px solid #cbd5e1; /* Dunklere Trennlinie */;
            padding-bottom: 10px;
            font-weight: 700; /* Fettere Schrift */;
        }
    
        .stat-value {
            color: #1a365d; /* Dunklere Farbe f√ºr bessere Lesbarkeit */;
            font-weight: 700;
            font-size: 1.8em; /* Gr√∂√üere Zahlen */;
        }
    
        .stat-change {
            color: #2f855a; /* Dunkleres Gr√ºn */;
            font-weight: 600;
        }
    
        .stat-change.negative {
            color: #c53030; /* Dunkleres Rot */;
        }
    
        .top-products ol {
            margin: 0;
            padding-left: 20px;
        }
    
        .top-products li {
            margin: 8px 0;
            color: #2d3748; /* Dunklere Textfarbe */;
            font-weight: 500;
        }
    
        .profit-overview, .payment-status, .averages {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
    
        .profit-item, .status-item, .average-item {
            background-color: rgba(255, 255, 255, 0.9); /* Hellerer Hintergrund */;
            padding: 12px;
            border-radius: 6px;
            margin: 5px 0;
            border: 1px solid #cbd5e1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
    
        .profit-item:hover, 
        .status-item:hover, 
        .average-item:hover {
            background-color: #ffffff;
            border-color: #a0aec0; /* Dunklerer Rahmen beim Hover */;
        }
    
        .profit-item:last-child, 
        .status-item:last-child, 
        .average-item:last-child {
            border-bottom: none;
        }
    
        .unpaid {
            color: #c53030; /* Dunkleres Rot */;
            font-weight: 700;
        }
    
        @media (max-width: 768px) {
            .stats-row {
                grid-template-columns: repeat(auto-fit, minmax(184px, 1fr)); /* 160px + 15% */;
                gap: 10px;
            }
    
            .stat-value {
                font-size: 1.5em;
            }
        }
    
        /* Neue Nutzeranalyse-Stile */
        .stats-row.full-width {
            width: 100%;
            margin: 0;
            padding: 0;
        }
    
        .stats-card.full-width {
            background: linear-gradient(145deg, #ffffff, #edf2f7);
            border: 1px solid #cbd5e1;
        }
    
        .user-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
    
        .user-search {
            flex: 1;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 6px;
        }
    
        .user-sort {
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 6px;
        }
    
        .users-table-container {
            width: 100%;
            overflow-x: auto;
            margin: 0;
            padding: 0;
            -webkit-overflow-scrolling: touch;
            max-height: 400px; /* Verkleinere die maximale H√∂he */
        }
    
        .users-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            font-size: 0.9em; /* Verkleinere die Schriftgr√∂√üe */
        }
    
        .users-table th, 
        .users-table td {
            padding: 8px 12px; /* Verkleinere den Padding */
            border-bottom: 1px solid #e9ecef;
            vertical-align: middle;
        }
    
        .users-table th {
            background-color: #34495e;
            color: white;
            font-weight: 600;
            font-size: 0.95em; /* Verkleinere die Header-Schriftgr√∂√üe */
            position: sticky;
            top: 0;
            z-index: 10;
        }
    
        /* Verkleinere die Buttons in der Tabelle */
        .users-table .show-invoice-btn {
            padding: 6px 10px;
            font-size: 0.85em;
        }
    
        /* Verkleinere die Status-Badges */
        .users-table .unpaid-badge,
        .users-table .paid-badge {
            padding: 4px 8px;
            font-size: 0.85em;
        }
    
        /* Hover-Effekt f√ºr Header */
        .users-table th:hover {
            background-color: #2c3e50;
        }
    
        /* Zellen-Styling */
        .users-table td {
            padding: 12px;
            border-bottom: 1px solid #e9ecef;
            vertical-align: middle;
        }
    
        /* Zeilen-Hover-Effekt */
        .users-table tbody tr:hover {
            background-color: #f8f9fa;
        }
    
        /* Spezifische Spaltenausrichtung */
        .users-table th:nth-child(2),
        .users-table td:nth-child(2) {
            text-align: center; /* Bestellungen */;
        }
    
        .users-table th:nth-child(3),
        .users-table td:nth-child(3),
        .users-table th:nth-child(4),
        .users-table td:nth-child(4),
        .users-table th:nth-child(5),
        .users-table td:nth-child(5) {
            text-align: right; /* Geldbetr√§ge */;
        }
    
        .users-table th:nth-child(6),
        .users-table td:nth-child(6) {
            text-align: center; /* Datum */;
        }
    
        .users-table th:nth-child(7),
        .users-table td:nth-child(7) {
            text-align: center; /* Status */;
        }
    
        /* Zebra-Streifen f√ºr bessere Lesbarkeit */
        .users-table tbody tr:nth-child(even) {
            background-color: #f8f9fa;
        }
    
        /* Status-Badge Optimierung */
        .users-table .unpaid-badge,
        .users-table .paid-badge {
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            display: inline-block;
            min-width: 100px;
        }
    
        .users-table .unpaid-badge {
            background-color: #fff5f5;
            color: #dc3545;
            border: 1px solid #dc3545;
        }
    
        .users-table .paid-badge {
            background-color: #f0fff4;
            color: #28a745;
            border: 1px solid #28a745;
        }
    
        /* Container-Styling f√ºr besseres Scrolling */
        .users-table-container {
            margin: 20px 0;
            border-radius: 8px;
            overflow: auto;
            max-height: 690px; /* 600px + 15% */;
            scrollbar-width: thin;
            scrollbar-color: #34495e #f8f9fa;
        }
    
        /* Scrollbar-Styling f√ºr Webkit-Browser */
        .users-table-container::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
    
        .users-table-container::-webkit-scrollbar-track {
            background: #f8f9fa;
            border-radius: 4px;
        }
    
        .users-table-container::-webkit-scrollbar-thumb {
            background-color: #34495e;
            border-radius: 4px;
        }
    
        /* Responsive Anpassungen */
        @media (max-width: 768px) {
            .users-table th,
            .users-table td {
                padding: 10px 8px;
                font-size: 0.9em;
            }
    
            .users-table th {
                font-size: 1em;
            }
        }
    
        .storno-badge {
            background-color: #dc3545;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            margin-left: 10px;
        }
    
        .cancel-order-btn {
            background-color: #dc3545;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }
    
        .cancel-order-btn:hover {
            background-color: #c82333;
            transform: translateY(-1px);
        }
    
        .storno-info {
            margin-top: 15px;
            padding: 10px;
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 4px;
            color: #721c24;
        }
    
        .invoice-history-item.storniert {
            opacity: 0.7;
            border-left: 4px solid #dc3545;
        }
    
        .order-status.storniert {
            background-color: #dc3545;
            color: white;
        }
    
        .undo-cancel-btn {
            background-color: var(--earth-yellow);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }
    
        .undo-cancel-btn:hover {
            background-color: var(--earth-yellow-hover);
            transform: translateY(-1px);
        }
    
        .history-item.storniert {
            opacity: 0.8;
            border-left: 4px solid var(--fire-red);
            background-color: #fff5f5;
        }
    
        .history-item.storniert .history-header {
            background-color: #fff5f5;
        }
    
        .history-item.storniert .storno-info {
            margin: 15px 0;
            padding: 15px;
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 8px;
            color: #721c24;
        }
    
        .history-item.storniert .storno-info p {
            margin: 5px 0;
        }
    
        .history-item.storniert .history-order-item {
            background-color: rgba(255, 255, 255, 0.7);
        }
    
        .history-item.storniert .history-totals {
            background-color: rgba(255, 255, 255, 0.7);
            padding: 10px;
            border-radius: 6px;
        }
    
        .history-item.paid {
            border-left: 4px solid var(--wood-green);
        }
    
        .history-item.unpaid {
            border-left: 4px solid var(--fire-red);
        }

        /* Optimiertes Suchfeld-Layout */
        .search-container {
            margin: 25px 0;
            padding: 20px;
            background: linear-gradient(145deg, #ffffff, #e8edf2);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid #d1d9e6;
        }

        .search-box {
            display: flex;
            gap: 12px;
            align-items: center;
            position: relative;
        }

        .search-input {
            flex: 1;
            padding: 15px 20px;
            padding-left: 45px; /* Platz f√ºr das Suchsymbol */
            border: 2px solid #cbd5e1;
            border-radius: 8px;
            font-size: 16px;
            color: #2c3e50;
            background: #ffffff url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'%3E%3C/line%3E%3C/svg%3E") 15px center no-repeat;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #2c3e50;
            box-shadow: 0 0 0 3px rgba(44, 62, 80, 0.1);
            background-color: #ffffff;
        }

        .search-input::placeholder {
            color: #94a3b8;
            font-style: italic;
        }

        .search-button {
            padding: 15px 25px;
            background-color: #2c3e50;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .search-button:hover {
            background-color: #1a252f;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .clear-search {
            background: linear-gradient(145deg, #ff6b6b, #ff3b30);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 50%; /* Runde Form */
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .clear-search:hover {
            background: linear-gradient(145deg, #ff3b30, #ff1a1a);
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        /* Responsive Anpassungen */
        @media (max-width: 768px) {
            .search-container {
                margin: 15px 0;
                padding: 15px;
            }

            .search-box {
                flex-direction: column;
            }

            .search-input {
                width: 100%;
                padding: 12px 15px;
                padding-left: 40px;
                font-size: 15px;
            }

            .search-button {
                width: 100%;
                padding: 12px 20px;
            }

            .clear-search {
                position: absolute;
                right: 10px;
                top: 50%;
                transform: translateY(-50%);
            }
        }

        /* Action-Buttons Kacheloptik */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(230px, 1fr)); /* 200px + 15% */
            gap: 15px;
            padding: 20px;
            background: linear-gradient(145deg, #ffffff, #e8edf2);
            border-radius: 12px;
            border: 1px solid #d1d9e6;
        }

        .action-buttons button {
            height: 138px; /* 120px + 15% */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 20px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        /* Spezifische Button-Styles */
        .action-buttons .primary-button {
            background: linear-gradient(145deg, #4b7b3f, #3d6433);
            color: white;
        }

        .action-buttons .secondary-button {
            background: linear-gradient(145deg, #2874a6, #1b4f72);
            color: white;
        }

        .action-buttons #showAdmin {
            background: linear-gradient(145deg, #512888, #3a1d64);
            color: white;
        }

        .action-buttons #showHistory {
            background: linear-gradient(145deg, #104e8b, #083c6c);
            color: white;
        }

        .action-buttons #resetData {
            background: linear-gradient(145deg, #a32020, #7f1717);
            color: white;
        }

        .action-buttons #showStatistics {
            background: linear-gradient(145deg, #2c3e50, #1a252f);
            color: white;
        }

        /* Hover-Effekte */
        .action-buttons button:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* Icon-Styling */
        .action-buttons button::before {
            font-size: 24px;
            margin-bottom: 8px;
        }

        /* Responsive Anpassungen */
        @media (max-width: 768px) {
            .action-buttons {
                grid-template-columns: repeat(auto-fit, minmax(173px, 1fr)); /* 150px + 15% */;
                gap: 10px;
                padding: 15px;
            }

            .action-buttons button {
                height: 115px; /* 100px + 15% */;
                font-size: 0.9em;
                padding: 15px;
            }
        }

        /* Aktive/Fokus Zust√§nde */
        .action-buttons button:active,
        .action-buttons button:focus {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            outline: none;
        }

        /* Basis-Styling f√ºr alle Sektionen */
        .section-card {
            background: #ffffff;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 35px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            position: relative;
        }

        /* Nutzersektion Styling */
        #userSection {
            background: linear-gradient(145deg, #ffffff, #e8edf2);
            border-left: 6px solid #4b7b3f;
            margin-top: 35px;
            box-shadow: 0 5px 15px rgba(75, 123, 63, 0.1);
        }

        #userSection::before {
            content: "üë§ customer";
            position: absolute;
            top: -12px;
            left: 20px;
            background: #4b7b3f;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        #userSection h2 {
            color: #2c3e50;
            font-size: 1.6em;
            margin: 15px 0 25px 0;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(75, 123, 63, 0.2);
        }

        /* Bestell√ºbersicht Styling */
        .order-summary {
            background: linear-gradient(145deg, #ffffff, #f0f4f8);
            border-left: 6px solid #2874a6;
            box-shadow: 0 5px 15px rgba(40, 116, 166, 0.1);
        }

        .order-summary::before {
            content: "üìã make a order";
            position: absolute;
            top: -12px;
            left: 20px;
            background: #2874a6;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .order-summary h2 {
            color: #2c3e50;
            font-size: 1.6em;
            margin: 15px 0 25px 0;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(40, 116, 166, 0.2);
        }

        /* Action-Buttons Bereich */
        .action-buttons.section-card {
            background: linear-gradient(145deg, #ffffff, #edf2f7);
            padding: 40px 30px;
            margin: 45px 0;
            border-left: 6px solid #34495e;
            box-shadow: 0 8px 20px rgba(52, 73, 94, 0.12);
        }

        .action-buttons.section-card::before {
            content: "üéÆ Apps";
            position: absolute;
            top: -12px;
            left: 20px;
            background: #34495e;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        /* Action-Buttons Grid */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 25px;
        }

        /* Einzelne Action-Buttons */
        .action-buttons button {
            height: 140px;
            border-radius: 15px;
            padding: 20px;
            font-size: 1.15em;
            font-weight: 600;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
            border: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        /* Hover-Effekte f√ºr Buttons */
        .action-buttons button:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        /* Trennlinien zwischen Sektionen */
        .section-divider {
            height: 3px;
            background: linear-gradient(to right, 
                transparent, 
                rgba(52, 73, 94, 0.1), 
                transparent
            );
            margin: 40px 0;
            border: none;
        }

        /* Responsive Anpassungen */
        @media (max-width: 768px) {
            .section-card {
                padding: 25px 20px;
                margin-bottom: 30px;
            }

            .action-buttons.section-card {
                padding: 30px 20px;
            }

            .action-buttons {
                grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
                gap: 15px;
            }

            .action-buttons button {
                height: 120px;
                font-size: 1em;
                padding: 15px;
            }

            #userSection h2,
            .order-summary h2 {
                font-size: 1.4em;
                margin: 20px 0 20px 0;
            }
        }

        .sales-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .sales-search {
            flex: 1;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 6px;
        }

        .sales-sort {
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 6px;
        }

        /* Kompaktere Sales Table */
        .sales-table-container {
            width: 100%;
            overflow-x: auto;
            margin: 0;
            padding: 0;
            -webkit-overflow-scrolling: touch;
            max-height: 400px; /* Begrenzt die H√∂he */
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .sales-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em; /* Kleinere Schriftgr√∂√üe */
            background: white;
        }

        .sales-table th,
        .sales-table td {
            padding: 8px; /* Reduzierter Padding */
            border: 1px solid #dee2e6;
            text-align: right; /* Standardm√§√üig rechtsb√ºndig f√ºr Zahlen */
        }

        .sales-table th:first-child,
        .sales-table td:first-child {
            text-align: left; /* Produktname linksb√ºndig */
        }

        .sales-table th {
            background-color: #34495e;
            color: white;
            font-weight: 600;
            font-size: 0.95em;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        /* Optimierte Spaltenbreiten */
        .sales-table td:nth-child(1) { width: 20%; } /* Produktname */
        .sales-table td:nth-child(2) { width: 12%; } /* Anfangsbestand */
        .sales-table td:nth-child(3) { width: 12%; } /* Aktueller Bestand */
        .sales-table td:nth-child(4) { width: 10%; } /* Verkauft */
        .sales-table td:nth-child(5) { width: 12%; } /* Umsatz */
        .sales-table td:nth-child(6) { width: 12%; } /* Gewinn */
        .sales-table td:nth-child(7) { width: 12%; } /* Lagerwert */
        .sales-table td:nth-child(8) { width: 10%; } /* AB Wert */

        /* Hover-Effekte */
        .sales-table tr:hover {
            background-color: #f8f9fa;
        }

        /* Zusammenfassungszeile */
        .sales-table tr:last-child {
            font-weight: bold;
            background-color: #f8f9fa;
            border-top: 2px solid #dee2e6;
        }

        /* Responsive Anpassungen */
        @media screen and (max-width: 768px) {
            .sales-table th,
            .sales-table td {
                padding: 6px;
                font-size: 0.85em;
            }
        }

        .opos-summary {
            font-size: 1.2em;
            color: #c53030; /* Rot f√ºr offene Betr√§ge */;
            font-weight: bold;
        }

        .product-filter {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .product-ranking-select,
        .product-metric-select {
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            min-width: 180px;
            background-color: white;
        }

        .ranking-limit {
            width: 80px;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            text-align: center;
        }

        .product-ranking-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .product-ranking-table th,
        .product-ranking-table td {
            padding: 12px;
            border-bottom: 1px solid #e9ecef;
            text-align: left;
        }

        .product-ranking-table th {
            background-color: #34495e;
            color: white;
            font-weight: 600;
        }

        .product-ranking-table tr:hover {
            background-color: #f8f9fa;
        }

        .rank-number {
            font-weight: bold;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            margin: 0 auto;
        }

        .rank-top-3 {
            background-color: #ffd700;
            color: #2c3e50;
        }

        .rank-top-10 {
            background-color: #c0c0c0;
            color: #2c3e50;
        }

        .rank-other {
            background-color: #cd7f32;
            color: white;
        }

        .trend-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: bold;
        }

        .trend-up {
            color: #28a745;
        }

        .trend-down {
            color: #dc3545;
        }

        .trend-neutral {
            color: #6c757d;
        }

        /* Action-Buttons Styling mit verbesserten Hover-Effekten */
        .action-buttons.section-card {
            background: linear-gradient(145deg, #ffffff, #edf2f7);
            padding: 40px 30px;
            margin: 45px 0;
            border-left: 6px solid #34495e;
            box-shadow: 0 8px 20px rgba(52, 73, 94, 0.12);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .action-buttons.section-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(52, 73, 94, 0.2);
            background: linear-gradient(145deg, #ffffff, #e2e8f0);
            border-left-width: 10px;
        }

        /* Einzelne Buttons innerhalb der Action-Buttons Section */
        .action-buttons button {
            position: relative;
            overflow: hidden;
            height: 140px;
            border-radius: 15px;
            padding: 20px;
            font-size: 1.15em;
            font-weight: 600;
            letter-spacing: 0.5px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            z-index: 1;
        }

        /* Hover-Effekt f√ºr einzelne Buttons */
        .action-buttons button:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        /* Glowing Effekt beim Hover */
        .action-buttons button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 70%);
            transform: translate(-50%, -50%);
            transition: width 0.6s ease, height 0.6s ease;
            border-radius: 50%;
            z-index: -1;
            opacity: 0;
        }

        .action-buttons button:hover::before {
            width: 200%;
            height: 200%;
            opacity: 1;
        }

        /* Spezifische Button-Varianten mit verbesserten Hover-Effekten */
        .action-buttons .primary-button {
            background: linear-gradient(145deg, var(--wood-green), var(--wood-green-hover));
        }

        .action-buttons .primary-button:hover {
            background: linear-gradient(145deg, var(--wood-green-hover), var(--wood-green));
        }

        .action-buttons .secondary-button {
            background: linear-gradient(145deg, var(--water-blue), var(--water-blue-hover));
        }

        .action-buttons .secondary-button:hover {
            background: linear-gradient(145deg, var(--water-blue-hover), var(--water-blue));
        }

        .action-buttons #showAdmin {
            background: linear-gradient(145deg, var(--admin-purple), var(--admin-purple-hover));
        }

        .action-buttons #showAdmin:hover {
            background: linear-gradient(145deg, var(--admin-purple-hover), var(--admin-purple));
        }

        .action-buttons #resetData {
            background: linear-gradient(145deg, var(--danger-red), var(--danger-red-hover));
        }

        .action-buttons #resetData:hover {
            background: linear-gradient(145deg, var(--danger-red-hover), var(--danger-red));
        }

        /* Aktive/Fokus Zust√§nde mit verbessertem visuellen Feedback */
        .action-buttons button:active {
            transform: translateY(2px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .action-buttons button:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 73, 94, 0.3);
        }

        /* Pulsierender Effekt f√ºr wichtige Buttons */
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(52, 73, 94, 0.4);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(52, 73, 94, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(52, 73, 94, 0);
            }
        }

        .action-buttons button.pulse {
            animation: pulse 2s infinite;
        }

        .invoice-list {
            max-height: 690px; /* 600px + 15% */;
            overflow-y: auto;
            padding: 10px 0;
            background-color: #e6ebf2; /* 10% intensiver als vorheriges #f5f7fa */;
        }

        /* Zus√§tzlich passe ich die Scrollbar-Farben an f√ºr bessere Sichtbarkeit */
        .invoice-list::-webkit-scrollbar {
            width: 8px;
        }

        .invoice-list::-webkit-scrollbar-track {
            background: #e6ebf2;
            border-radius: 4px;
        }

        .invoice-list::-webkit-scrollbar-thumb {
            background-color: var(--wood-green);
            border-radius: 4px;
        }
        
        .top-products-header {
            color: #2c3e50; /* Dunklere Farbe f√ºr besseren Kontrast */
            font-size: 1.4em;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(145deg, #e8f0f8, #d1e7f3); /* Leichter blauer Hintergrund */
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* CSS-Styles */
        .hidden {
            display: none !important;
        }

        /* Zahlungsstatus Styling */
        .payment-status {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid var(--wood-green);
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 15px;
        }

        .payment-status.paid {
            background: #e8f5e9;
            border-color: var(--wood-green);
        }

        .payment-status.unpaid {
            background: #fff5f5;
            border-color: var(--fire-red);
        }

        .payment-input-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 10px 0;
            padding: 15px;
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .payment-amount-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--wood-green);
            border-radius: 6px;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .confirm-payment-button {
            width: 100%;
            background-color: var(--wood-green);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .remaining-amount {
            font-size: 1.4em;
            padding: 15px 25px;
            border-radius: 8px;
            margin-top: 15px;
            font-weight: 600;
            text-align: center;
            width: 80%; /* Vergr√∂√üerte Breite */
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
            margin: 0 auto; /* Zentriert das Element horizontal */
        }

        .unpaid-amount {
            background: #fff5f5;
            color: var(--fire-red);
            border: 2px solid var(--fire-red);
        }

        .paid-amount {
            background: #e8f5e9;
            color: var(--wood-green);
            border: 2px solid var(--wood-green);
        }

        .product-search {
            flex: 1;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            min-width: 200px;
        }

        .product-filter {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .no-results {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
            background: #f8f9fa;
        }

        @media (max-width: 768px) {
            .product-filter {
                flex-direction: column;
                align-items: stretch;
            }
            
            .product-search,
            .product-ranking-select,
            .product-metric-select,
            .ranking-limit {
                width: 100%;
            }
        }

        /* 1. CSS-Variablen f√ºr wiederverwendete Werte */
        :root {
            /* Farben */
            --primary-color: var(--wood-green);
            --primary-hover: var(--wood-green-hover);
            --secondary-color: var(--water-blue);
            --secondary-hover: var(--water-blue-hover);
            --danger-color: var(--delete-red);
            --danger-hover: var(--delete-red-hover);
            
            /* Abst√§nde */
            --spacing-xs: 5px;
            --spacing-sm: 10px;
            --spacing-md: 15px;
            --spacing-lg: 20px;
            --spacing-xl: 25px;
            
            /* Schatten */
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.12);
            --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.15);
            
            /* Border-Radius */
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            
            /* Transitions */
            --transition-fast: all 0.2s ease;
            --transition-normal: all 0.3s ease;
        }

        /* 2. Gemeinsame Basis-Stile */
        .card {
            background: #ffffff;
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow-sm);
            transition: var(--transition-normal);
        }

        .card:hover {
            box-shadow: var(--shadow-md);
        }

        /* 3. Flexbox-Utilities */
        .flex {
            display: flex;
        }

        .flex-col {
            flex-direction: column;
        }

        .items-center {
            align-items: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .gap-sm { gap: var(--spacing-sm); }
        .gap-md { gap: var(--spacing-md); }
        .gap-lg { gap: var(--spacing-lg); }

        /* 4. Button-Basis */
        .btn {
            padding: var(--spacing-sm) var(--spacing-lg);
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-normal);
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        /* 5. Form-Elemente */
        .input-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .input, .select {
            padding: var(--spacing-sm);
            border: 1px solid #ced4da;
            border-radius: var(--radius-sm);
            transition: var(--transition-normal);
        }

        /* 6. Tabellen-Basis */
        .table-container {
            overflow-x: auto;
            margin: var(--spacing-md) 0;
        }

        .table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        .table th, .table td {
            padding: var(--spacing-sm);
            border-bottom: 1px solid #dee2e6;
        }

        /* 7. Responsive Breakpoints */
        @media (max-width: 1024px) {
            :root {
                /* Angepasste Abst√§nde f√ºr Tablets */
                --spacing-lg: 15px;
                --spacing-xl: 20px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: var(--spacing-sm);
            }
            
            .flex-responsive {
                flex-direction: column;
            }
            
            .table-scroll {
                max-width: 100%;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
        }

        @media (max-width: 480px) {
            :root {
                /* Angepasste Abst√§nde f√ºr Mobilger√§te */
                --spacing-lg: 10px;
                --spacing-xl: 15px;
            }
            
            .btn {
                width: 100%;
            }
        }

        /* F√ºge diese CSS-Styles hinzu/√§ndere sie */

        .user-input {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
        }

        .user-input label {
            font-size: 1.1em;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .user-input input {
            width: 80%;
            max-width: 300px;
            padding: 10px;
            border: 2px solid var(--wood-green);
            border-radius: 6px;
            text-align: center;
        }

        .user-input button {
            margin-top: 10px;
            width: 80%;
            max-width: 300px;
        }

        #userSection {
            text-align: center;
        }

        #userSection h2 {
            margin-bottom: 20px;
        }

        /* F√ºge diese CSS-Styles f√ºr die Verkaufsanalyse-Tabelle hinzu */
        .sales-table td:first-child {
            background-color: #f0f4f8;
            font-weight: 500;
            border-right: 2px solid #dee2e6;
            position: relative;
        }

        .sales-table td:first-child::after {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 4px;
            background-color: var(--wood-green);
            opacity: 0.7;
        }

        /* Hover-Effekt f√ºr bessere Interaktivit√§t */
        .sales-table tr:hover td:first-child {
            background-color: #e3e9f0;
        }

        /* Verbesserte Lesbarkeit */
        .sales-table td:first-child {
            padding-left: 15px;
            white-space: nowrap;
        }

        /* Styles f√ºr die Verkaufsanalyse-Sektion */
        .stats-card.full-width {
            padding: 20px;
            width: 85%; /* Verkleinerte Desktop-Ansicht */
            margin: 0 auto; /* Zentrieren */
        }

        .sales-table-container {
            width: 100%;
            overflow-x: auto;
            margin: 0;
            padding: 0;
            -webkit-overflow-scrolling: touch;
        }

        .sales-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* Responsive Anpassungen */
        @media (max-width: 768px) {
            .stats-card.full-width {
                width: 100%; /* Volle Breite auf mobilen Ger√§ten */
                padding: 10px;
                margin: 0;
            }

            .sales-table-container {
                margin: 0 -10px; /* Negative Margins um die Container-Padding auszugleichen */
            }

            .sales-table {
                border-radius: 0; /* Keine abgerundeten Ecken auf mobilen Ger√§ten */
            }
        }

        /* F√ºge diese CSS-Styles f√ºr die Produkt-Ranking-Tabelle hinzu/aktualisiere sie */
        .product-ranking-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .product-ranking-table th,
        .product-ranking-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        .product-ranking-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        .rank-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #e9ecef;
            color: #495057;
            font-weight: bold;
        }

        .rank-top-3 {
            background-color: var(--wood-green);
            color: white;
        }

        .rank-top-10 {
            background-color: var(--water-blue);
            color: white;
        }

        .trend-indicator {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9em;
            font-weight: 500;
        }

        .trend-up {
            background-color: #e8f5e9;
            color: #2e7d32;
        }

        .trend-down {
            background-color: #ffebee;
            color: #c62828;
        }

        .trend-neutral {
            background-color: #f5f5f5;
            color: #616161;
        }

        /* Styles f√ºr die Produktanalyse-Tabelle */
        .product-analysis-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .product-analysis-table th,
        .product-analysis-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        .product-analysis-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        .product-analysis-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .product-analysis-table tr:hover {
            background-color: #e9ecef;
        }

        /* Trend-Indikatoren */
        .trend-analysis {
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 500;
            display: inline-block;
        }

        .trend-up {
            background-color: #d4edda;
            color: #155724;
        }

        .trend-down {
            background-color: #f8d7da;
            color: #721c24;
        }

        .trend-stable {
            background-color: #e2e3e5;
            color: #383d41;
        }

        .product-trend-container {
            overflow-x: auto;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .product-trend-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .product-trend-table th,
        .product-trend-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        .product-trend-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        .trend-up {
            color: #28a745;
        }

        .trend-down {
            color: #dc3545;
        }

        .trend-stable {
            color: #6c757d;
        }

        .product-trend-table tbody tr:last-child {
            border-bottom: none;
        }

        .admin-section {
            overflow-x: auto;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .price-management-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .price-management-table th,
        .price-management-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        .price-management-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        .price-management-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .price-management-table tr:hover {
            background-color: #e9ecef;
        }

        @media (max-width: 768px) {
            .price-management-table th,
            .price-management-table td {
                padding: 8px;
                font-size: 14px;
            }
        }

        .show-invoice-btn {
            background-color: var(--water-blue); /* Verwende die Wasser-Blau-Farbe */
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .show-invoice-btn:hover {
            background-color: var(--water-blue-hover); /* Verwende die Hover-Variante */
            transform: translateY(-2px);
        }

        /* Kompaktere Price Management Tabelle */
        .price-management {
            margin: 15px 0;
            overflow-x: auto;
            max-height: 400px; /* Begrenzt die H√∂he */
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .price-management table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em; /* Kleinere Schriftgr√∂√üe */
        }

        .price-management th,
        .price-management td {
            padding: 8px; /* Reduzierter Padding */
            border: 1px solid #dee2e6;
            text-align: left;
        }

        .price-management th {
            background-color: #34495e;
            color: white;
            font-weight: 600;
            font-size: 0.95em;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .price-management input {
            width: calc(100% - 16px);
            padding: 6px;
            font-size: 0.9em;
            border: 1px solid #ced4da;
            border-radius: 4px;
        }

        .price-management button {
            padding: 6px 10px;
            font-size: 0.85em;
            margin: 2px;
            min-width: auto;
        }

        .price-management .add-product,
        .price-management .save-price,
        .price-management .delete-price {
            padding: 6px 10px;
            font-size: 0.85em;
        }

        /* Optimierte Spaltenbreiten */
        .price-management td:nth-child(1) { width: 25%; } /* Produktname */
        .price-management td:nth-child(2) { width: 20%; } /* Einkaufspreis */
        .price-management td:nth-child(3) { width: 20%; } /* Verkaufspreis */
        .price-management td:nth-child(4) { width: 15%; } /* Lagerbestand */
        .price-management td:nth-child(5) { width: 20%; } /* Aktionen */

        /* Hover-Effekte */
        .price-management tr:hover {
            background-color: #f8f9fa;
        }

        /* Responsive Anpassungen */
        @media screen and (max-width: 768px) {
            .price-management {
                margin: 10px -15px;
                border-radius: 0;
            }
            
            .price-management button {
                padding: 4px 8px;
                font-size: 0.8em;
            }
        }

        /* Aktualisiere die Spaltenausrichtung in der users-table */
        .users-table th:nth-child(1),
        .users-table td:nth-child(1) {
            text-align: left; /* Name */
        }

        .users-table th:nth-child(2),
        .users-table td:nth-child(2),
        .users-table th:nth-child(3),
        .users-table td:nth-child(3),
        .users-table th:nth-child(4),
        .users-table td:nth-child(4) {
            text-align: right; /* Zahlen rechtsb√ºndig */
        }

        .users-table th:nth-child(5),
        .users-table td:nth-child(5) {
            text-align: center; /* Datum */
        }

        .users-table th:nth-child(6),
        .users-table td:nth-child(6) {
            text-align: center; /* Status */
        }

        .users-table th:nth-child(7),
        .users-table td:nth-child(7) {
            text-align: center; /* Show Invoice Button */
        }

        /* Aktualisiere den Table Header */
        const usersTable = document.querySelector('.users-table thead tr');
        if (usersTable) {
            usersTable.innerHTML = `
                <th>Customer</th>
                <th>Order</th>
                <th>Revenue</th>
                <th>Profit</th>
                <th>Last Order</th>
                <th>Status</th>
                <th>Show Invoice</th>
            `;
        }

        /* F√ºge CSS f√ºr die Lagerbestandsanzeige hinzu */
        .current-stock {
            font-weight: bold;
            padding: 8px;
            display: inline-block;
        }

        .low-stock .current-stock {
            color: #dc3545;
        }

        .stock-warning {
            font-size: 0.8em;
            color: #dc3545;
            margin-top: 4px;
        }

        td.low-stock {
            background-color: #fff5f5;
            border-left: 3px solid #dc3545;
        }
    </style>


</head>

<body>
    <div class="container">
        <header>
            <h1>üçï Mini ERP System</h1>
        </header>
        
        <!-- Nutzerauswahl-Sektion -->
        <section id="userSection" class="section-card">
            <h2>üë§ Customer</h2>
            <div class="user-input">
                <label for="userName"></label>
                <input 
                    type="text" 
                    id="userName" 
                    placeholder="Namen eingeben" 
                    autocomplete="name"
                    required
                >
                <button 
                    type="button" 
                    id="startOrder" 
                    class="primary-button"
                    aria-label="Bestellung starten"
                >
                    start order
                </button>
            </div>
            <div id="activeUser" class="hidden">
                <p class="user-info">Aktiver Nutzer: <span id="currentUser"></span></p>
                <button 
                    type="button" 
                    id="changeUser" 
                    class="secondary-button"
                >
                    change user
                </button>
            </div>
        </section>

        <!-- Bestellformular -->
        <form id="kassenForm" class="hidden section-card">
            <div class="form-group">
                <label for="quantity">quantity:</label>
                <input 
                    type="number" 
                    id="quantity" 
                    min="0.01" 
                    max="999.99"
                    step="0.01"
                    value="1" 
                    required
                >
            </div>

            <div class="form-group">
                <label for="pizzaType">pizza type:</label>
                <select id="pizzaType" required>
                    <option value="" disabled selected>please select</option>
                    <option value="Pizza A" data-base-price="15">test</option>
                    <option value="Pizza B" data-base-price="20"> Plus</option>
                    <option value="Pizza C" data-base-price="25">Honig</option>
                    <option value="Hawaii" data-base-price="30">Hawaii (11‚Ç¨)</option>
                    <option value="Quattro" data-base-price="12">Quattro Formaggi (12‚Ç¨)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="sellingPrice">selling price (‚Ç¨):</label>
                <input 
                    type="number" 
                    id="sellingPrice" 
                    step="0.01" 
                    min="0"
                    required
                >
                <small class="price-hint">
                    recommended selling price: <span id="recommendedPrice">0.00</span>
                </small>
            </div>

            <div class="button-group">
                <button 
                    type="button" 
                    id="addPosition" 
                    class="primary-button"
                >
                    <span>+</span> add position
                </button>
                <button 
                    type="button" 
                    id="closeOrder" 
                    class="secondary-button"
                >
                    close order
                </button>
            </div>
        </form>

        <!-- Bestell√ºbersicht -->
        <section class="order-summary section-card">
            <h2>üìã make a order</h2>
            <div class="table-responsive">
                <table id="orderTable" class="order-table">
                    <thead>
                        <tr>
                            <th>Nutzer</th>
                            <th>Menge</th>
                            <th>Pizzaart</th>
                            <th>Verkaufspreis</th>
                            <th>Summe</th>
                            <th>Gewinn</th>
                            <th>Aktion</th>
                        </tr>
                    </thead>
                    <tbody id="orderTableBody"></tbody>
                    <tfoot>
                        <tr>
                            <td colspan="4"><strong>Gesamt:</strong></td>
                            <td id="totalSum" class="total-sum">0.00‚Ç¨</td>
                            <td id="totalProfit" class="total-profit">0.00‚Ç¨</td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </section>

        <section class="action-buttons section-card">
            <button 
                id="generateInvoice" 
                class="primary-button"
                aria-label="Rechnung generieren"
            >
                üßæ show invoice
            </button>
            
            <button 
                id="exportJSON" 
                class="secondary-button"
                aria-label="Als JSON exportieren"
            >
                üíæ JSON Export
            </button>
        </section>

        <section id="invoiceContainer" class="hidden section-card">
            <h2>üßæ show invoice</h2>
            <div id="invoiceContent" class="invoice-content"></div>
            <button 
                id="printInvoice" 
                class="primary-button"
                onclick="window.print()"
            >
                üñ®Ô∏è print
            </button>
        </section>

        <section id="adminSection" class="section-card hidden">
            <h2>‚öôÔ∏è price management</h2>
            <div class="admin-section">
                <div class="price-management">
                    <table id="priceManagementTable">
                        <thead>
                            <tr>
                                <th>pizza type</th>
                                <th>purchase price (‚Ç¨)</th>
                                <th>recommended selling price (‚Ç¨)</th>
                                <th>initial stock</th>
                                <th>current stock</th> <!-- Neue Spalte -->
                                <th>update stock</th>
                                <th>action</th>
                            </tr>
                        </thead>
                        <tbody id="priceManagementBody">
                            <!-- Wird dynamisch bef√ºllt -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        
    </div>
   <script> 
   // Hilfsfunktionen
const formatCurrency = (amount) => `${amount.toFixed(2)}‚Ç¨`;
const clearInputFields = (form) => {
    form.querySelectorAll('input, select').forEach(input => input.value = '');
};

// Globale Variablen
let currentUser = null;
let orders = [];
let orderHistory = []; // Neue Variable f√ºr die Bestellhistorie

// Bestellhistorie aus dem localStorage laden
const loadOrderHistory = () => {
    const savedHistory = localStorage.getItem('orderHistory');
    orderHistory = savedHistory ? JSON.parse(savedHistory) : [];
};

// Bestellhistorie im localStorage speichern
const saveOrderHistory = () => {
    localStorage.setItem('orderHistory', JSON.stringify(orderHistory));
};

// Initialisierung beim Laden
loadOrderHistory();

// Funktion zum Aktualisieren des Zahlungsstatus
const updatePaymentStatus = (orderId, paid, amountPaid = 0) => {
    const orderIndex = orderHistory.findIndex(order => order.id === orderId);
    if (orderIndex !== -1) {
        const order = orderHistory[orderIndex];
        const newAmountPaid = parseFloat(amountPaid);
        
        if (isNaN(newAmountPaid) || newAmountPaid < 0) {
            alert('Bitte geben Sie einen g√ºltigen Betrag ein.');
            return;
        }

        order.bezahlt = paid;
        order.gezahlteBetrag = newAmountPaid;
        order.offenerBetrag = Math.max(0, order.gesamtbetrag - newAmountPaid);
        
        // Automatisch als bezahlt markieren, wenn der komplette Betrag bezahlt wurde
        if (order.offenerBetrag === 0) {
            order.bezahlt = true;
        }
        
        saveOrderHistory();
        updateOrderHistoryDisplay();
    }
};

// √úberarbeitete updateOrderHistoryDisplay Funktion
const updateOrderHistoryDisplay = () => {
    const historyContainer = document.getElementById('orderHistoryContainer');
    if (!historyContainer) return;

    historyContainer.innerHTML = `
        <h2>üìã Zahlungsstatus bearbeiten</h2>
        <div class="history-list">
            ${orderHistory.map(order => `
                <div class="history-item ${order.storniert ? 'storniert' : (order.bezahlt ? 'paid' : 'unpaid')}">
                    <div class="history-header">
                        <span class="customer-name">üë§ ${order.kunde}</span>
                        <span>üìÖ ${new Date(order.datum).toLocaleString('de-DE')}</span>
                    </div>
                    <div class="history-details">
                        <p>Bestellungen:</p>
                        ${order.bestellungen.map(item => `
                            <div class="history-order-item">
                                ${item.quantity}x ${item.pizzaType} - ${formatCurrency(item.total)} 
                                <span>(Verkaufspreis: ${formatCurrency(item.sellingPrice)})</span> <!-- Verkaufspreis hinzuf√ºgen -->
                            </div>
                        `).join('')}
                        <div class="history-totals">
                            <p>Gesamtbetrag: ${formatCurrency(order.gesamtbetrag)}</p>
                            <p>Gewinn: ${formatCurrency(order.gesamtgewinn)}</p>
                        </div>
                        <button 
                            class="show-invoice-btn"
                            onclick="showSingleInvoice(
                                [{ 
                                    pizzaType: 'Pizza Premium', 
                                    quantity: 1, 
                                    sellingPrice: 80, 
                                    purchasePrice: 30, 
                                    total: 80, 
                                    profit: 50 
                                }], 
                                '2', 
                                new Date('2025-01-15T14:20:51.255Z'), 
                                1736950851255, 
                                false
                            )"
                        >
                            üßæ show invoice
                        </button>
                        ${order.storniert ? `
                            <div class="storno-info">
                                <p>‚ö†Ô∏è Diese Rechnung wurde storniert</p>
                                <p>Storniert am: ${new Date(order.storniertAm).toLocaleString('de-DE')}</p>
                                <button 
                                    class="undo-cancel-btn"
                                    onclick="undoCancelOrder(${order.id})"
                                >
                                    ‚Ü©Ô∏è Stornierung r√ºckg√§ngig machen
                                </button>
                            </div>
                        ` : `
                            <div class="payment-section">
                                <div class="payment-amount">
                                    <div class="payment-input-group">
                                        <label>Gezahlter Betrag:</label>
                                        <input 
                                            type="number" 
                                            id="payment-${order.id}"
                                            class="payment-input"
                                            step="0.01" 
                                            value="${order.gezahlteBetrag || 0}"
                                            min="0"
                                            max="${order.gesamtbetrag}"
                                        >
                                        <button 
                                            class="confirm-payment-button"
                                            onclick="updatePaymentStatus(${order.id}, ${order.bezahlt}, document.getElementById('payment-${order.id}').value)"
                                        >
                                            üí∞ Zahlung best√§tigen
                                        </button>
                                    </div>
                                    <div class="payment-status">
                                        <label>
                                            <input type="checkbox" 
                                                ${order.bezahlt ? 'checked' : ''} 
                                                onchange="updatePaymentStatus(${order.id}, this.checked, ${order.gezahlteBetrag || 0})"
                                            >
                                            Bezahlt
                                        </label>
                                    </div>
                                    <p class="remaining-amount ${order.offenerBetrag > 0 ? 'unpaid-amount' : 'paid-amount'}">
                                        ${order.offenerBetrag > 0 
                                            ? `Noch offen: ${formatCurrency(order.offenerBetrag)}` 
                                            : '‚úÖ Vollst√§ndig bezahlt'}
                                    </p>
                                </div>
                            </div>
                            <button 
                                class="cancel-order-btn"
                                onclick="cancelOrder(${order.id})"
                            >
                                üö´ Bestellung stornieren
                            </button>
                        `}
                    </div>
                </div>
            `).join('')}
        </div>
    `;
};

// Funktion zum Zur√ºcksetzen aller Daten
const resetAllData = () => {
    if (confirm('M√∂chten Sie wirklich alle Daten zur√ºcksetzen? Dieser Vorgang kann nicht r√ºckg√§ngig gemacht werden!')) {
        // Zweite Best√§tigung f√ºr zus√§tzliche Sicherheit
        if (confirm('ACHTUNG: Alle Bestellungen und die komplette Historie werden gel√∂scht. Sind Sie sicher?')) {
            // Zur√ºcksetzen aller Daten
            orders = [];
            orderHistory = [];
            localStorage.removeItem('orderHistory');
            
            // UI zur√ºcksetzen
            updateOrderTable();
            updateOrderHistoryDisplay();
            
            // Nutzer-Reset
            currentUser = null;
            userNameInput.disabled = false;
            userNameInput.value = '';
            currentUserSpan.textContent = '';
            activeUserSection.classList.add('hidden');
            kassenForm.classList.add('hidden');
            invoiceContainer.classList.add('hidden');
            
            // Best√§tigung anzeigen
            alert('Alle Daten wurden erfolgreich zur√ºckgesetzt.');
        }
    }
};

// Elemente aus dem DOM
const userNameInput = document.getElementById("userName");
const startOrderButton = document.getElementById("startOrder");
const activeUserSection = document.getElementById("activeUser");
const currentUserSpan = document.getElementById("currentUser");
const changeUserButton = document.getElementById("changeUser");

const kassenForm = document.getElementById("kassenForm");
const quantityInput = document.getElementById("quantity");
const pizzaTypeSelect = document.getElementById("pizzaType");
const sellingPriceInput = document.getElementById("sellingPrice");
const recommendedPriceSpan = document.getElementById("recommendedPrice");
const addPositionButton = document.getElementById("addPosition");
const closeOrderButton = document.getElementById("closeOrder");

const orderTableBody = document.getElementById("orderTableBody");
const totalSumElement = document.getElementById("totalSum");
const totalProfitElement = document.getElementById("totalProfit");
const totalInitialStockElement = document.getElementById("totalInitialStock");

const generateInvoiceButton = document.getElementById("generateInvoice");
const exportJSONButton = document.getElementById("exportJSON");
const invoiceContainer = document.getElementById("invoiceContainer");
const invoiceContent = document.getElementById("invoiceContent");
const printInvoiceButton = document.getElementById("printInvoice");

// Nutzerverwaltung
startOrderButton.addEventListener("click", () => {
    const userName = userNameInput.value.trim();
    if (userName) {
        currentUser = userName;
        currentUserSpan.textContent = userName;
        userNameInput.value = "";
        userNameInput.disabled = true;
        activeUserSection.classList.remove("hidden");
        kassenForm.classList.remove("hidden");
    } else {
        alert("Bitte geben Sie einen Nutzernamen ein.");
    }
});

changeUserButton.addEventListener("click", () => {
    if (confirm("M√∂chten Sie den Nutzer wirklich wechseln? Alle Bestellungen werden zur√ºckgesetzt.")) {
        currentUser = null;
        orders = [];
        updateOrderTable();
        currentUserSpan.textContent = "";
        userNameInput.disabled = false;
        activeUserSection.classList.add("hidden");
        kassenForm.classList.add("hidden");
    }
});

// Empfohlener Verkaufspreis anzeigen
pizzaTypeSelect.addEventListener("change", (event) => {
    const selectedOption = event.target.selectedOptions[0];
    const basePrice = parseFloat(selectedOption.dataset.basePrice || 0);
    recommendedPriceSpan.textContent = formatCurrency(basePrice);
});

// Bestellung hinzuf√ºgen
addPositionButton.addEventListener("click", () => {
    const quantity = parseFloat(quantityInput.value);
    const pizzaType = pizzaTypeSelect.value;
    const sellingPrice = parseFloat(sellingPriceInput.value);

    if (!pizzaType || quantity <= 0 || isNaN(sellingPrice) || sellingPrice <= 0) {
        alert("Bitte f√ºllen Sie alle Felder korrekt aus.");
        return;
    }

    const purchasePrice = pizzaPrices[pizzaType].purchase;
    
    // Pr√§zise Berechnung mit 2 Dezimalstellen
    const total = Math.round(quantity * sellingPrice * 100) / 100;
    const profit = Math.round((sellingPrice - purchasePrice) * quantity * 100) / 100;

    orders.push({
        user: currentUser,
        quantity: Math.round(quantity * 100) / 100, // Runde die Menge auf 2 Dezimalstellen
        pizzaType,
        sellingPrice: Math.round(sellingPrice * 100) / 100, // Runde den Verkaufspreis
        purchasePrice,
        total,
        profit
    });

    updateOrderTable();
    clearInputFields(kassenForm);
});

// Bestellungstabelle aktualisieren
const updateOrderTable = () => {
    orderTableBody.innerHTML = "";
    
    // Verwende reduce mit pr√§ziser Berechnung
    const { totalSum, totalProfit } = orders.reduce((acc, order) => ({
        totalSum: acc.totalSum + order.total,
        totalProfit: acc.totalProfit + order.profit
    }), { totalSum: 0, totalProfit: 0 });

    orders.forEach((order, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${order.user}</td>
            <td>${order.quantity.toFixed(2)}</td>
            <td>${order.pizzaType}</td>
            <td>${formatCurrency(order.sellingPrice)}</td>
            <td>${formatCurrency(order.total)}</td>
            <td>${formatCurrency(order.profit)}</td>
            <td>
                <button class="remove" data-index="${index}">‚ùå</button>
            </td>
        `;
        orderTableBody.appendChild(row);
    });

    // Runde die Gesamtsummen auf 2 Dezimalstellen
    totalSumElement.textContent = formatCurrency(Math.round(totalSum * 100) / 100);
    totalProfitElement.textContent = formatCurrency(Math.round(totalProfit * 100) / 100);

    // L√∂schen-Buttons
    document.querySelectorAll(".remove").forEach(button => {
        button.addEventListener("click", () => {
            const index = parseInt(button.dataset.index);
            orders.splice(index, 1);
            updateOrderTable();
        });
    });
};

// Bestellung abschlie√üen mit pr√§zisen Berechnungen
closeOrderButton.addEventListener("click", () => {
    if (orders.length === 0) {
        alert("Es gibt keine Bestellungen, die abgeschlossen werden k√∂nnen.");
        return;
    }

    // Pr√§zise Berechnung der Gesamtsummen
    const gesamtbetrag = Math.round(orders.reduce((sum, order) => sum + order.total, 0) * 100) / 100;
    const gesamtgewinn = Math.round(orders.reduce((sum, order) => sum + order.profit, 0) * 100) / 100;

    const completedOrder = {
        id: Date.now(),
        datum: new Date().toISOString(),
        kunde: currentUser,
        bestellungen: orders.map(order => ({
            pizzaType: order.pizzaType,
            quantity: order.quantity,
            sellingPrice: order.sellingPrice,
            purchasePrice: order.purchasePrice,
            total: order.total,
            profit: order.profit
        })),
        gesamtbetrag,
        gesamtgewinn,
        bezahlt: false,
        gezahlteBetrag: 0,
        offenerBetrag: gesamtbetrag
    };

    orderHistory.push(completedOrder);
    saveOrderHistory();
    
    alert("Bestellung erfolgreich abgeschlossen!");
    orders = [];
    updateOrderTable();
    updateOrderHistoryDisplay();
});

// F√ºge einen Button f√ºr die Bestellhistorie hinzu
const showHistoryButton = document.createElement('button');
showHistoryButton.id = 'showHistory';
showHistoryButton.className = 'secondary-button';
showHistoryButton.innerHTML = 'üí∂ Zahlungsstatus bearbeiten';
showHistoryButton.addEventListener('click', () => {
    const historyContainer = document.getElementById('orderHistoryContainer');
    historyContainer.classList.toggle('hidden');
    if (!historyContainer.classList.contains('hidden')) {
        updateOrderHistoryDisplay();
    }
});

// F√ºge den Container f√ºr die Bestellhistorie hinzu
const historyContainer = document.createElement('section');
historyContainer.id = 'orderHistoryContainer';
historyContainer.className = 'section-card hidden';
document.querySelector('.container').appendChild(historyContainer);

// F√ºge den History-Button zur Action-Buttons-Section hinzu
document.querySelector('.action-buttons').appendChild(showHistoryButton);

// Reset-Button hinzuf√ºgen
const resetButton = document.createElement('button');
resetButton.id = 'resetData';
resetButton.className = 'danger-button';
resetButton.innerHTML = 'üóëÔ∏è Storage zur√ºcksetzen';
resetButton.addEventListener('click', resetAllData);

// Reset-Button zur Action-Buttons-Section hinzuf√ºgen
document.querySelector('.action-buttons').appendChild(resetButton);

// Event Listener f√ºr die Buttons
generateInvoiceButton.addEventListener("click", () => {
    const invoiceContainer = document.getElementById('invoiceContainer');
    const invoiceContent = document.getElementById('invoiceContent');
    invoiceContainer.classList.toggle('hidden');
    if (!invoiceContainer.classList.contains('hidden')) {
        showInvoiceHistory();
    } else {
        invoiceContent.innerHTML = ''; // Leere den Inhalt wenn ausgeblendet
    }
});

// Entferne den Tooltip, da die Doppelklick-Funktion nicht mehr ben√∂tigt wird
generateInvoiceButton.removeAttribute('title');

// Funktion zum Stornieren einer Bestellung
const cancelOrder = (orderId) => {
    if (confirm('M√∂chten Sie diese Bestellung wirklich stornieren? Dieser Vorgang kann r√ºckg√§ngig gemacht werden.')) {
        const orderIndex = orderHistory.findIndex(order => order.id === orderId);
        if (orderIndex !== -1) {
            // Markiere die Bestellung als storniert
            orderHistory[orderIndex].storniert = true;
            orderHistory[orderIndex].storniertAm = new Date().toISOString();
            saveOrderHistory();
            
            // Aktualisiere alle relevanten Anzeigen
            updateOrderHistoryDisplay();
            if (document.getElementById('searchResults').innerHTML) {
                searchCustomer(orderHistory[orderIndex].kunde);
            }
            if (document.getElementById('statisticsSection')) {
                updateStatisticsDisplay();
            }
            alert('Die Bestellung wurde erfolgreich storniert.');
        }
    }
};

// Neue Funktion zum R√ºckg√§ngig machen einer Stornierung
const undoCancelOrder = (orderId) => {
    if (confirm('M√∂chten Sie die Stornierung dieser Bestellung wirklich r√ºckg√§ngig machen?')) {
        const orderIndex = orderHistory.findIndex(order => order.id === orderId);
        if (orderIndex !== -1) {
            // Entferne die Stornierung
            orderHistory[orderIndex].storniert = false;
            delete orderHistory[orderIndex].storniertAm;
            saveOrderHistory();
            
            // Aktualisiere alle relevanten Anzeigen
            updateOrderHistoryDisplay();
            if (document.getElementById('searchResults').innerHTML) {
                searchCustomer(orderHistory[orderIndex].kunde);
            }
            if (document.getElementById('statisticsSection')) {
                updateStatisticsDisplay();
            }
            alert('Die Stornierung wurde erfolgreich r√ºckg√§ngig gemacht.');
        }
    }
};

// Modifiziere die showSingleInvoice Funktion
const showSingleInvoice = (orderItems, customer, orderDate = new Date(), orderId = null, isStorniert = false) => {
    const totalSum = orderItems.reduce((sum, order) => sum + order.total, 0);
    const date = orderDate.toLocaleDateString('de-DE');
    const time = orderDate.toLocaleTimeString('de-DE');

    // L√∂sche vorherige Inhalte
    invoiceContent.innerHTML = '';

    // Erstelle die Rechnungsansicht
    const invoiceView = document.createElement('div');
    invoiceView.innerHTML = `
        <div class="invoice-header">
            <h3>Rechnung ${isStorniert ? '<span class="storno-badge">Storniert</span>' : ''}</h3>
            <p><strong>Datum:</strong> ${date}</p>
            <p><strong>Zeit:</strong> ${time}</p>
            <p><strong>Kunde:</strong> ${customer}</p>
        </div>
        <div class="invoice-items">
            <div class="invoice-item header">
                <span class="item-details">Artikel</span>
                <span class="item-price">Betrag</span>
            </div>
            ${orderItems.map(order => `
                <div class="invoice-item">
                    <div class="item-details">
                        <div class="item-name">${order.pizzaType}</div>
                        <div class="item-info">
                            ${order.quantity} Stk √ó ${formatCurrency(order.sellingPrice)}
                        </div>
                    </div>
                    <span class="item-price">${formatCurrency(order.total)}</span>
                </div>
            `).join("")}
            <div class="invoice-item total">
                <span class="item-details"><strong>Gesamtbetrag:</strong></span>
                <span class="item-price"><strong>${formatCurrency(totalSum)}</strong></span>
            </div>
        </div>
        <div class="invoice-footer">
            <p class="invoice-thank-you">Vielen Dank f√ºr Ihren Einkauf!</p>
            <p class="invoice-date">${new Date().toLocaleString('de-DE')}</p>
        </div>
    `;

    // F√ºge einen "Zur√ºck zur √úbersicht" Button hinzu
    const backButton = document.createElement('button');
    backButton.className = 'secondary-button';
    backButton.style.marginTop = '20px';
    backButton.innerHTML = '‚Üê Zur√ºck zur √úbersicht';
    backButton.addEventListener('click', () => {
        showInvoiceHistory();
    });

    // F√ºge die Elemente zum Container hinzu
    invoiceContent.appendChild(invoiceView);
    invoiceContent.appendChild(backButton);
};

// Modifiziere die showInvoiceHistory Funktion
const showInvoiceHistory = () => {
    // Pr√ºfe ob es aktuelle oder historische Bestellungen gibt
    const hasCurrentOrders = orders.length > 0;
    const hasHistoricalOrders = orderHistory.length > 0;

    if (!hasCurrentOrders && !hasHistoricalOrders) {
        alert("Keine Bestellungen oder Rechnungen verf√ºgbar.");
        return;
    }

    // L√∂sche vorherige Inhalte
    invoiceContent.innerHTML = '';

    // Container f√ºr die Rechnungsliste
    const historyContainer = document.createElement('div');
    historyContainer.className = 'invoice-history';
    
    // √úberschrift
    const header = document.createElement('h3');
    header.textContent = 'Rechnungs√ºbersicht';
    historyContainer.appendChild(header);

    // Liste der Rechnungen
    const list = document.createElement('div');
    list.className = 'invoice-list';

    // Aktuelle Bestellung hinzuf√ºgen, falls vorhanden
    if (hasCurrentOrders) {
        const currentOrderItem = document.createElement('div');
        currentOrderItem.className = 'invoice-history-item current-order';
        const totalSum = orders.reduce((sum, order) => sum + order.total, 0);
        
        currentOrderItem.innerHTML = `
            <div class="order-header">
                <span class="order-label">Aktuelle Bestellung</span>
                <span class="order-status">In Bearbeitung</span>
            </div>
            <p><strong>Kunde:</strong> ${currentUser}</p>
            <p><strong>Datum:</strong> ${new Date().toLocaleString('de-DE')}</p>
            <p><strong>Betrag:</strong> ${formatCurrency(totalSum)}</p>
            <button class="show-invoice-btn">Rechnung anzeigen</button>
        `;

        currentOrderItem.querySelector('.show-invoice-btn').addEventListener('click', () => {
            showSingleInvoice(orders, currentUser);
        });

        list.appendChild(currentOrderItem);
    }

    // Historische Bestellungen hinzuf√ºgen
    if (hasHistoricalOrders) {
        orderHistory.slice().reverse().forEach((order, index) => {
            const historyItem = document.createElement('div');
            historyItem.className = `invoice-history-item ${order.storniert ? 'storniert' : ''}`;
            
            historyItem.innerHTML = `
                <div class="order-header">
                    <span class="order-label">Rechnung #${orderHistory.length - index}</span>
                    <span class="order-status ${order.storniert ? 'storniert' : (order.bezahlt ? 'paid' : 'unpaid')}">
                        ${order.storniert ? 'Storniert' : (order.bezahlt ? 'Bezahlt' : 'Offen')}
                    </span>
                </div>
                <p><strong>Kunde:</strong> ${order.kunde}</p>
                <p><strong>Datum:</strong> ${new Date(order.datum).toLocaleString('de-DE')}</p>
                <p><strong>Betrag:</strong> ${formatCurrency(order.gesamtbetrag)}</p>
                <button class="show-invoice-btn">Rechnung anzeigen</button>
            `;

            historyItem.querySelector('.show-invoice-btn').addEventListener('click', () => {
                showSingleInvoice(order.bestellungen, order.kunde, new Date(order.datum), order.id, order.storniert);
            });

            list.appendChild(historyItem);
        });
    }

    // F√ºge die Liste zum Container hinzu
    historyContainer.appendChild(list);

    // Zeige den Container an
    invoiceContainer.classList.remove('hidden');
    invoiceContent.appendChild(historyContainer);
};

// F√ºge CSS f√ºr die verbesserte Rechnungsansicht hinzu
const style = document.createElement('style');
style.textContent = `
    .invoice-history {
        padding: 20px;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .invoice-list {
        max-height: 690px; /* 600px + 15% */
        overflow-y: auto;
        padding: 10px 0;
        background-color: #e6ebf2; /* 10% intensiver als vorheriges #f5f7fa */
    }

    .invoice-history-item {
        background: #f8f9fa;
        padding: 20px;
        margin: 10px 0;
        border-radius: 8px;
        border-left: 4px solid #ddd;
        transition: all 0.3s ease;
    }

    .invoice-history-item:hover {
        transform: translateX(5px);
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .invoice-history-item.current-order {
        border-left-color: var(--wood-green);
        background: #f0f7f0;
    }

    .order-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid #ddd;
    }

    .order-status {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.9em;
        font-weight: 600;
    }

    .order-status.paid {
        background: #d4edda;
        color: #155724;
    }

    .order-status.unpaid {
        background: #f8d7da;
        color: #721c24;
    }

    .show-invoice-btn {
        background-color: var(--water-blue); /* Verwende die Wasser-Blau-Farbe */
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
    }

    .show-invoice-btn:hover {
        background-color: var(--water-blue-hover); /* Verwende die Hover-Variante */
        transform: translateY(-2px);
    }

    .invoice-history-item p {
        margin: 8px 0;
        color: #495057;
    }
`;
document.head.appendChild(style);

// Standardpreise als Objekt
let pizzaPrices = {
    PizzaPremium: { purchase: 10, selling: 15, initialStock: 100 },
    PizzaFungi: { purchase: 10, selling: 12, initialStock: 100 },
    Vegetarisch: { purchase: 3.5, selling: 9, initialStock: 100 },
    Hawaii: { purchase: 4.5, selling: 11, initialStock: 100 },
    Quattro: { purchase: 5, selling: 12, initialStock: 100 },
    Test1: { purchase: 5, selling: 12, initialStock: 100 },
    Test2: { purchase: 5, selling: 12, initialStock: 100 }
};

// Preise aus dem localStorage laden
const loadPizzaPrices = () => {
    const savedPrices = localStorage.getItem('pizzaPrices');
    if (savedPrices) {
        pizzaPrices = JSON.parse(savedPrices);
    }
};

// Preise im localStorage speichern
const savePizzaPrices = () => {
    localStorage.setItem('pizzaPrices', JSON.stringify(pizzaPrices));
};

// Admin-Bereich anzeigen
const updatePriceManagementTable = () => {
    const tbody = document.getElementById('priceManagementBody');
    tbody.innerHTML = '';

    // Neue Produkt-Zeile
    const addRow = document.createElement('tr');
    addRow.innerHTML = `
        <td>
            <input type="text" class="new-product-name" placeholder="new pizza type">
        </td>
        <td>
            <input type="number" step="0.01" class="new-product-purchase" placeholder="purchase price">
        </td>
        <td>
            <input type="number" step="0.01" class="new-product-selling" placeholder="recommended selling price">
        </td>
        <td>
            <input type="number" class="new-product-stock" placeholder="initial stock" value="100">
        </td>
        <td>
            <span class="current-stock">-</span>
        </td>
        <td>
            <input type="number" class="new-product-update-stock" placeholder="update stock">
        </td>
        <td>
            <button class="add-product">‚ûï add</button>
        </td>
    `;
    tbody.appendChild(addRow);

    // Event-Listener f√ºr neues Produkt
    addRow.querySelector('.add-product').addEventListener('click', () => {
        const name = addRow.querySelector('.new-product-name').value.trim();
        const purchase = parseFloat(addRow.querySelector('.new-product-purchase').value);
        const selling = parseFloat(addRow.querySelector('.new-product-selling').value);
        const initialStock = parseInt(addRow.querySelector('.new-product-stock').value) || 100;

        if (name && !isNaN(purchase) && !isNaN(selling) && !isNaN(initialStock)) {
            pizzaPrices[name] = { 
                purchase,
                selling,
                initialStock
            };
            savePizzaPrices();
            updatePriceManagementTable();
            updatePizzaTypeOptions();
        } else {
            alert('Bitte f√ºllen Sie alle Felder korrekt aus.');
        }
    });

    // Bestehende Produkte anzeigen
    Object.entries(pizzaPrices).forEach(([pizzaType, prices]) => {
        // Berechne den aktuellen Bestand f√ºr dieses Produkt
        const currentStock = calculateCurrentStock(pizzaType);
        const isLowStock = currentStock < 25;

        const row = document.createElement('tr');
        row.innerHTML = `
            <td>
                <input type="text" 
                    value="${pizzaType}" 
                    class="product-name" 
                    data-original="${pizzaType}"
                >
            </td>
            <td>
                <input type="number" 
                    step="0.01" 
                    value="${prices.purchase}" 
                    class="purchase-price"
                >
            </td>
            <td>
                <input type="number" 
                    step="0.01" 
                    value="${prices.selling}" 
                    class="selling-price"
                >
            </td>
            <td>
                <input type="number" 
                    value="${prices.initialStock || 100}" 
                    class="initial-stock"
                >
            </td>
            <td class="${isLowStock ? 'low-stock' : ''}">
                <span class="current-stock">
                    ${currentStock}
                    ${isLowStock ? ' ‚ö†Ô∏è' : ''}
                </span>
                ${isLowStock ? '<div class="stock-warning">Nachbestellen!</div>' : ''}
            </td>
            <td>
                <input type="number" 
                    class="update-stock"
                    placeholder="Menge hinzuf√ºgen"
                >
            </td>
            <td>
                <button class="save-price">üíæ save</button>
                <button class="delete-price">üóëÔ∏è delete</button>
            </td>
        `;
        tbody.appendChild(row);

        // Event-Listener f√ºr diese Zeile
        const saveBtn = row.querySelector('.save-price');
        const deleteBtn = row.querySelector('.delete-price');
        const nameInput = row.querySelector('.product-name');
        const purchaseInput = row.querySelector('.purchase-price');
        const sellingInput = row.querySelector('.selling-price');
        const stockInput = row.querySelector('.initial-stock');
        const updateStockInput = row.querySelector('.update-stock');

        saveBtn.addEventListener('click', () => {
            const originalName = nameInput.dataset.original;
            const newName = nameInput.value.trim();
            const purchasePrice = parseFloat(purchaseInput.value);
            const sellingPrice = parseFloat(sellingInput.value);
            let initialStock = parseInt(stockInput.value) || 0; // Stelle sicher, dass ein Wert existiert
            let updateStock = updateStockInput.value.trim() 
                ? parseInt(updateStockInput.value) 
                : 0;

            // Validierung der Eingaben
            if (!newName || isNaN(purchasePrice) || isNaN(sellingPrice) || isNaN(initialStock)) {
                alert('Bitte f√ºllen Sie alle Felder korrekt aus.');
                return;
            }

            // Hole den aktuellen Bestand
            const currentStock = calculateCurrentStock(originalName);
            
            // Berechne den neuen Bestand
            // Wenn updateStock eingegeben wurde, addiere es zum currentStock
            // Ansonsten verwende den eingegebenen initialStock
            const newInitialStock = updateStock > 0 
                ? currentStock + updateStock 
                : initialStock;

            // Wenn sich der Name ge√§ndert hat
            if (originalName !== newName) {
                delete pizzaPrices[originalName];
                nameInput.dataset.original = newName;
            }

            // Aktualisiere die Bestandsdaten
            pizzaPrices[newName] = {
                purchase: purchasePrice,
                selling: sellingPrice,
                initialStock: newInitialStock // Speichere den neuen Bestand
            };

            // Setze das Update-Stock-Feld zur√ºck
            updateStockInput.value = '';

            // Speichere die √Ñnderungen
            savePizzaPrices();
            
            // Aktualisiere die Anzeigen
            updatePizzaTypeOptions();
            updatePriceManagementTable(); // Aktualisiere die Tabelle direkt
            updateSalesAnalytics();
            
            alert('changes saved!');
        });

        deleteBtn.addEventListener('click', () => {
            const name = nameInput.dataset.original;
            if (confirm(`M√∂chten Sie "${name}" wirklich l√∂schen?`)) {
                delete pizzaPrices[name];
                savePizzaPrices();
                updatePizzaTypeOptions();
                updatePriceManagementTable();
                updateSalesAnalytics(); // Aktualisiere die Verkaufsanalyse
            }
        });
    });
};

// Funktion zum Aktualisieren der Pizza-Auswahloptionen
const updatePizzaTypeOptions = () => {
    pizzaTypeSelect.innerHTML = `
        <option value="" disabled selected>Bitte w√§hlen</option>
        ${Object.entries(pizzaPrices).map(([type, prices]) => `
            <option value="${type}" data-base-price="${prices.selling}">
                ${type} (${prices.selling}‚Ç¨)
            </option>
        `).join('')}
    `;
};

// Admin-Button zur Action-Buttons-Section hinzuf√ºgen
const adminButton = document.createElement('button');
adminButton.id = 'showAdmin';
adminButton.className = 'secondary-button';
adminButton.innerHTML = '‚öôÔ∏è Produktpflege';
adminButton.addEventListener('click', () => {
    const adminSection = document.getElementById('adminSection');
    adminSection.classList.toggle('hidden');
    if (!adminSection.classList.contains('hidden')) {
        updatePriceManagementTable();
    } else {
        // Optional: Leere die Tabelle wenn ausgeblendet
        document.getElementById('priceManagementBody').innerHTML = '';
    }
});

// F√ºge den Admin-Button zur Action-Buttons-Section hinzuf√ºgen
document.querySelector('.action-buttons').appendChild(adminButton);

// Initialisierung
loadPizzaPrices();
updatePizzaTypeOptions();

// Nach dem Admin-Button Code und vor dem Ende des Scripts
const statisticsButton = document.createElement('button');
statisticsButton.id = 'showStatistics';
statisticsButton.className = 'secondary-button';
statisticsButton.innerHTML = 'üìä statistics';
statisticsButton.style.backgroundColor = 'var(--report-blue)'; // Andere Farbe zur Unterscheidung

statisticsButton.addEventListener('click', () => {
    const existingStats = document.getElementById('statisticsSection');
    if (existingStats) {
        existingStats.classList.toggle('hidden');
        if (!existingStats.classList.contains('hidden')) {
            updateStatisticsDisplay();
        }
    } else {
        const statsSection = createStatisticsSection();
        document.querySelector('.container').appendChild(statsSection);
        updateStatisticsDisplay();
    }
});

// F√ºge den Statistik-Button zur Action-Buttons-Section hinzu
document.querySelector('.action-buttons').appendChild(statisticsButton);



// Erweitere die createStatisticsSection Funktion um eine Nutzeranalyse
function createStatisticsSection() {
    const section = document.createElement('section');
    section.id = 'statisticsSection';
    section.className = 'section-card hidden';
    
    section.innerHTML = `
        <h2>üìä Statistik & Auswertung</h2>
        <div class="stats-container">
            <div class="stats-row">
                <div class="stats-card">
                    <h3>revenue overview</h3>
                    <div class="profit-overview" id="revenueOverview">
                        <div class="profit-item">
                            <span>daily revenue:</span>
                            <span id="dailyRevenue">0.00‚Ç¨</span>
                        </div>
                        <div class="profit-item">
                            <span>weekly revenue:</span>
                            <span id="weeklyRevenue">0.00‚Ç¨</span>
                        </div>
                        <div class="profit-item">
                            <span>monthly revenue:</span>
                            <span id="monthlyRevenue">0.00‚Ç¨</span>
                        </div>
                        <div class="profit-item">
                            <span>total revenue:</span>
                            <span id="totalRevenue">0.00‚Ç¨</span>
                        </div>
                    </div>
                </div>
                <div class="stats-card">
                    <h3>profit overview</h3>
                    <div class="profit-overview" id="profitOverview">
                        <div class="profit-item">
                            <span>daily profit:</span>
                            <span id="dailyProfit">0.00‚Ç¨</span>
                        </div>
                        <div class="profit-item">
                            <span>weekly profit:</span>
                            <span id="weeklyProfit">0.00‚Ç¨</span>
                        </div>
                        <div class="profit-item">
                            <span>monthly profit:</span>
                            <span id="monthlyProfit">0.00‚Ç¨</span>
                        </div>
                        <div class="profit-item">
                            <span>total profit:</span>
                            <span id="totalProfit">0.00‚Ç¨</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="stats-row">
                <div class="stats-card">
                    <h3>OPOS</h3>
                    <div class="opos-summary">
                        <p>Offene Betr√§ge: <span id="totalUnpaidAmount">0.00‚Ç¨</span></p>
                    </div>
                </div>
                <div class="stats-card">
                    <h3 class="top-products-header">üèÜ popular products</h3>
                    <div class="top-products" id="topProducts">
                        <ol></ol>
                    </div>
                </div>
            </div>
            
            <div class="stats-row">
                <div class="stats-card">
                    <h3>payment status</h3>
                    <div class="payment-status">
                        <div class="status-item">
                            <span>open payments:</span>
                            <span id="unpaidAmount" class="unpaid">0.00‚Ç¨</span>
                        </div>
                        <div class="status-item">
                            <span>paid orders:</span>
                            <span id="paidOrders">0/0</span>
                        </div>
                    </div>
                </div>
                <div class="stats-card">
                    <h3>average values</h3>
                    <div class="averages">
                        <div class="average-item">
                            <span>√ò order value:</span>
                            <span id="avgOrderValue">0.00‚Ç¨</span>
                        </div>
                        <div class="average-item">
                            <span>√ò profit per order:</span>
                            <span id="avgOrderProfit">0.00‚Ç¨</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Neue Nutzeranalyse-Sektion -->
            <div class="stats-row full-width">
                <div class="stats-card full-width">
                    <h3>üë• Kundenanalyse</h3>
                    <div class="user-filter">
                        <input type="text" id="userFilter" placeholder="user search.." class="user-search">
                        <select id="userSortOption" class="user-sort">
                            <option value="orders">by number of orders</option>
                            <option value="revenue">by total revenue</option>
                            <option value="profit">by profit</option>
                            <option value="lastOrder">by last order</option>
                            <option value="status">by payment status</option>
                        </select>
                    </div>
                    <div class="users-table-container">
                        <table class="users-table">
                            <thead>
                                <tr>
                                    <th>customer</th>
                                    <th>order</th>
                                    <th>revenue</th>
                                    <th>profit</th>
                                    <th>last order</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="userAnalyticsBody">
                                <!-- Wird dynamisch bef√ºllt -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Neue Verkaufsanalyse-Sektion -->
            <div class="stats-row full-width">
                <div class="stats-card full-width">
                    <h3>üìà stock & sales analysis</h3>
                    <div class="sales-filter">
                        <input type="text" 
                            id="salesFilter" 
                            placeholder="Produkt oder Kategorie suchen..." 
                            class="sales-search"
                        >
                        <select id="salesSortOption" class="sales-sort">
                            <option value="stock">Nach Aktuellem Bestand</option>
                            <option value="quantity">Nach Verkaufsmenge</option>
                            <option value="revenue">Nach Umsatz</option>
                            <option value="profit">Nach Gewinn</option>
                        </select>
                    </div>
                    <div class="sales-table-container">
                        <table class="sales-table">
                            <thead>
                                <tr>
                                    <th>product</th>
                                    <th>initial stock</th> <!-- Neue Spalte hinzugef√ºgt -->
                                    <th>current stock</th>
                                    <th>sold</th>
                                    <th>revenue</th>
                                    <th>profit</th>
                                    <th>stock value</th>
                                    <th>AB Wert</th> <!-- Neue Spalte hinzugef√ºgt -->
                                </tr>
                            </thead>
                            <tbody id="salesAnalyticsBody">
                                <!-- Wird dynamisch bef√ºllt -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>
    `;

    return section;
}

// Erweitere updateStatisticsDisplay um die Nutzeranalyse
function updateStatisticsDisplay() {
    const today = new Date();
    const oneWeekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
    const oneMonthAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);

    // Filtere Bestellungen nach Zeitr√§umen und nicht storniert
    const todayOrders = orderHistory.filter(order => {
        const orderDate = new Date(order.datum);
        return orderDate.toDateString() === today.toDateString() && !order.storniert;
    });

    const weekOrders = orderHistory.filter(order => {
        const orderDate = new Date(order.datum);
        return orderDate >= oneWeekAgo && !order.storniert;
    });

    const monthOrders = orderHistory.filter(order => {
        const orderDate = new Date(order.datum);
        return orderDate >= oneMonthAgo && !order.storniert;
    });

    // Berechne Ums√§tze
    const dailyRevenue = todayOrders.reduce((sum, order) => sum + order.gesamtbetrag, 0);
    const weeklyRevenue = weekOrders.reduce((sum, order) => sum + order.gesamtbetrag, 0);
    const monthlyRevenue = monthOrders.reduce((sum, order) => sum + order.gesamtbetrag, 0);
    // Berechne Gesamtumsatz (ber√ºcksichtige stornierte Bestellungen)
    const totalRevenue = orderHistory.reduce((sum, order) => {
        // Ignoriere stornierte Bestellungen komplett
        if (order.storniert) {
            return sum;
        }
        // Addiere nur nicht-stornierte Bestellungen
        return sum + order.gesamtbetrag;
    }, 0);

    // Aktualisiere UI
    document.getElementById('dailyRevenue').textContent = formatCurrency(dailyRevenue);
    document.getElementById('weeklyRevenue').textContent = formatCurrency(weeklyRevenue);
    document.getElementById('monthlyRevenue').textContent = formatCurrency(monthlyRevenue);
    document.getElementById('totalRevenue').textContent = formatCurrency(totalRevenue);

    // Berechne Gewinne unter Ber√ºcksichtigung stornierter Bestellungen
    const dailyProfit = todayOrders.reduce((sum, order) => sum + order.gesamtgewinn, 0);
    const weeklyProfit = weekOrders.reduce((sum, order) => sum + order.gesamtgewinn, 0);
    const monthlyProfit = monthOrders.reduce((sum, order) => sum + order.gesamtgewinn, 0);
    // Berechne Gesamtgewinn (ignoriere stornierte Bestellungen)
    const totalProfit = orderHistory.reduce((sum, order) => {
        // Ignoriere stornierte Bestellungen komplett
        if (order.storniert) {
            return sum;
        }
        return sum + order.gesamtgewinn;
    }, 0);

    // Aktualisiere UI f√ºr Profit Overview
    document.getElementById('dailyProfit').textContent = formatCurrency(dailyProfit);
    document.getElementById('weeklyProfit').textContent = formatCurrency(weeklyProfit);
    document.getElementById('monthlyProfit').textContent = formatCurrency(monthlyProfit);
    document.getElementById('totalProfit').textContent = formatCurrency(totalProfit);

    // Berechne Top-Produkte (ignoriere stornierte Bestellungen)
    const productStats = {};
    orderHistory.forEach(order => {
        // √úberspringe stornierte Bestellungen
        if (order.storniert) return;
        
        order.bestellungen.forEach(item => {
            if (!productStats[item.pizzaType]) {
                productStats[item.pizzaType] = 0;
            }
            productStats[item.pizzaType] += item.quantity;
        });
    });

    const topProducts = Object.entries(productStats)
        .sort(([,a], [,b]) => b - a)
        .slice(0, 5);

    const topProductsList = document.querySelector('#topProducts ol');
    topProductsList.innerHTML = topProducts
        .map(([product, count]) => `<li>${product}: ${count}x</li>`)
        .join('');

    // Berechne Durchschnittswerte (ignoriere stornierte Bestellungen)
    const validOrders = orderHistory.filter(order => !order.storniert);
    const avgOrderValue = validOrders.length > 0 
        ? validOrders.reduce((sum, order) => sum + order.gesamtbetrag, 0) / validOrders.length 
        : 0;
    const avgOrderProfit = validOrders.length > 0 
        ? validOrders.reduce((sum, order) => sum + order.gesamtgewinn, 0) / validOrders.length 
        : 0;

    document.getElementById('avgOrderValue').textContent = formatCurrency(avgOrderValue);
    document.getElementById('avgOrderProfit').textContent = formatCurrency(avgOrderProfit);

    // Nutzeranalyse
    updateUserAnalytics();

    // Event Listener f√ºr Nutzerfilter und Sortierung
    const userFilter = document.getElementById('userFilter');
    const userSortOption = document.getElementById('userSortOption');

    userFilter.addEventListener('input', updateUserAnalytics);
    userSortOption.addEventListener('change', updateUserAnalytics);

    // Verkaufsanalyse
    updateSalesAnalytics();

    // Event Listener f√ºr Verkaufsfilter und Sortierung
    const salesFilter = document.getElementById('salesFilter');
    const salesSortOption = document.getElementById('salesSortOption');

    salesFilter.addEventListener('input', updateSalesAnalytics);
    salesSortOption.addEventListener('change', updateSalesAnalytics);

    // Funktion zur Aktualisierung der OPOS-Anzeige
    updateOposSummary();

    // Funktion zur Aktualisierung der Zahlungsstatus-Anzeige
    updatePaymentStatusDisplay();

    
}

// Neue Funktion f√ºr die Nutzeranalyse
function updateUserAnalytics() {
    const userFilter = document.getElementById('userFilter');
    const userSortOption = document.getElementById('userSortOption');
    const tbody = document.getElementById('userAnalyticsBody');

    // Sammle Daten pro Nutzer - Ignoriere stornierte Bestellungen
    const userStats = {};
    orderHistory.forEach(order => {
        if (order.storniert) return; // √úberspringe stornierte Bestellungen

        if (!userStats[order.kunde]) {
            userStats[order.kunde] = {
                name: order.kunde,
                orders: 0,
                revenue: 0,
                profit: order.gesamtgewinn,
                lastOrder: new Date(0),
                unpaidAmount: 0
            };
        }

        const stats = userStats[order.kunde];
        stats.orders++;
        stats.revenue += order.gesamtbetrag;
        stats.profit = order.gesamtgewinn;
        const orderDate = new Date(order.datum);
        if (orderDate > stats.lastOrder) {
            stats.lastOrder = orderDate;
        }
        if (!order.bezahlt && !order.storniert) { // Pr√ºfe auf unbezahlt UND nicht storniert
            stats.unpaidAmount += (order.offenerBetrag || 0);
        }
    });

    // Filtere nach Suchbegriff
    let users = Object.values(userStats);
    const filterText = userFilter.value.toLowerCase();
    if (filterText) {
        users = users.filter(user => 
            user.name.toLowerCase().includes(filterText)
        );
    }

    // Sortiere nach ausgew√§hlter Option
    const sortOption = userSortOption.value;
    users.sort((a, b) => {
        switch (sortOption) {
            case 'orders':
                return b.orders - a.orders;
            case 'revenue':
                return b.revenue - a.revenue;
            case 'profit':
                return b.profit - a.profit;
            case 'lastOrder':
                return b.lastOrder - a.lastOrder;
            case 'status':
                if (b.unpaidAmount === a.unpaidAmount) {
                    return b.revenue - a.revenue;
                }
                return b.unpaidAmount - a.unpaidAmount;
            default:
                return 0;
        }
    });

    // Aktualisiere Tabelle
    tbody.innerHTML = users.map(user => `
        <tr class="${user.unpaidAmount > 0 ? 'has-unpaid' : ''}">
            <td>${user.name}</td>
            <td>${user.orders}</td>
            <td>${formatCurrency(user.revenue)}</td>
            <td>${formatCurrency(user.profit)}</td>
            <td>${user.lastOrder.toLocaleDateString('de-DE')}</td>
            <td>
                ${user.unpaidAmount > 0 
                    ? `<span class="unpaid-badge">Offen: ${formatCurrency(user.unpaidAmount)}</span>`
                    : '<span class="paid-badge">‚úì Bezahlt</span>'
                }
            </td>
            <td>
                <button 
                    class="show-invoice-btn"
                    onclick="showUserHistory('${user.name}')"
                >
                    üßæ Rechnungen
                </button>
            </td>
        </tr>
    `).join('');

    // Berechne die Summen
    const totals = users.reduce((acc, user) => ({
        totalOrders: acc.totalOrders + user.orders,
        totalRevenue: acc.totalRevenue + user.revenue,
        totalProfit: acc.totalProfit + user.profit
    }), { totalOrders: 0, totalRevenue: 0, totalProfit: 0 });

    // F√ºge die Zusammenfassungszeile hinzu
    tbody.innerHTML += `
        <tr style="font-weight: bold; background-color: #f8f9fa; border-top: 2px solid #dee2e6;">
            <td>Gesamt</td>
            <td>${totals.totalOrders}</td>
            <td>${formatCurrency(totals.totalRevenue)}</td>
            <td>${formatCurrency(totals.totalProfit)}</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
        </tr>
    `;
}

// F√ºge die neue showUserHistory Funktion hinzu
function showUserHistory(userName) {
    const userOrders = orderHistory.filter(order => 
        order.kunde === userName
    ).sort((a, b) => new Date(b.datum) - new Date(a.datum));

    const historyContainer = document.createElement('div');
    historyContainer.className = 'history-list';
    
    historyContainer.innerHTML = `
        <h3>Rechnungshistorie: ${userName}</h3>
        ${userOrders.map(order => {
            // Escape die Bestelldaten korrekt f√ºr den onclick-Handler
            const bestellungenJSON = JSON.stringify(order.bestellungen)
                .replace(/'/g, "\\'")
                .replace(/"/g, '\\"');
            
            return `
                <div class="history-item ${order.storniert ? 'storniert' : (order.bezahlt ? 'paid' : 'unpaid')}">
                    <div class="history-header">
                        <span>üìÖ ${new Date(order.datum).toLocaleString('de-DE')}</span>
                        ${order.storniert ? '<span class="storno-badge">Storniert</span>' : ''}
                    </div>
                    <div class="history-details">
                        <p>Bestellungen:</p>
                        ${order.bestellungen.map(item => `
                            <div class="history-order-item">
                                ${item.quantity}x ${item.pizzaType} - ${formatCurrency(item.total)}
                            </div>
                        `).join('')}
                        <div class="history-totals">
                            <p>Gesamtbetrag: ${formatCurrency(order.gesamtbetrag)}</p>
                            <p>Gewinn: ${formatCurrency(order.gesamtgewinn)}</p>
                        </div>
                        ${!order.storniert ? `
                            <div class="payment-status">
                                <p>Zahlungsstatus: ${order.bezahlt ? 'Bezahlt' : 'Offen'}</p>
                                ${!order.bezahlt ? `
                                    <p class="unpaid-amount">Noch offen: ${formatCurrency(order.offenerBetrag || order.gesamtbetrag)}</p>
                                ` : ''}
                            </div>
                        ` : ''}
                        <button 
                            class="show-invoice-btn"
                            onclick="showSingleInvoice(JSON.parse('${bestellungenJSON}'), '${userName}', new Date('${order.datum}'), ${order.id}, ${order.storniert})"
                        >
                            üßæ Rechnung anzeigen
                        </button>
                    </div>
                </div>
            `;
        }).join('')}
        <button class="secondary-button" onclick="closeUserHistory()">Schlie√üen</button>
    `;

    // Zeige das Modal
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.appendChild(historyContainer);
    document.body.appendChild(modal);

    // F√ºge CSS f√ºr das Modal hinzu
    const style = document.createElement('style');
    style.textContent = `
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .history-list {
            background: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .history-item {
            margin: 10px 0;
            padding: 15px;
            border-radius: 8px;
            background: #f8f9fa;
        }
    `;
    document.head.appendChild(style);
}

// F√ºge die closeUserHistory Funktion hinzu
function closeUserHistory() {
    const modal = document.querySelector('.modal');
    if (modal) {
        modal.remove();
    }
}

// Modifiziere die searchCustomer Funktion
const searchCustomer = (customerName) => {
    const searchTerm = customerName.toLowerCase().trim();
    
    // Ber√ºcksichtige alle Bestellungen
    const customerOrders = orderHistory.filter(order => 
        order.kunde.toLowerCase().includes(searchTerm) && !order.storniert
    );

    if (customerOrders.length === 0) {
        searchResults.innerHTML = `
            <div class="no-results">
                Keine aktiven Bestellungen f√ºr "${customerName}" gefunden
            </div>
        `;
        searchResults.classList.remove('hidden');
        return;
    }

    // Optimierte Statistikberechnung - Nur aktive Bestellungen
    const stats = customerOrders.reduce((acc, order) => ({
        totalOrders: acc.totalOrders + 1,
        totalSpent: acc.totalSpent + order.gesamtbetrag,
        totalProfit: acc.totalProfit + order.gesamtgewinn,
        totalItems: acc.totalItems + order.bestellungen.reduce((sum, item) => sum + item.quantity, 0),
        unpaidAmount: acc.unpaidAmount + (!order.bezahlt ? (order.offenerBetrag || 0) : 0)
    }), {
        totalOrders: 0,
        totalSpent: 0,
        totalProfit: 0,
        totalItems: 0,
        unpaidAmount: 0
    });

    // Generiere HTML f√ºr die Ergebnisse mit Zahlungsfunktionalit√§t
    searchResults.innerHTML = `
        <div class="customer-summary">
            <h3>Kunden√ºbersicht: ${customerOrders[0].kunde}</h3>
            <div class="customer-stats">
                <div class="stat-item">
                    <div class="stat-label">Anzahl Bestellungen</div>
                    <div class="stat-value">${stats.totalOrders}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Gesamtumsatz</div>
                    <div class="stat-value">${formatCurrency(stats.totalSpent)}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Gesamtgewinn</div>
                    <div class="stat-value">${formatCurrency(stats.totalProfit)}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Offene Zahlungen</div>
                    <div class="stat-value ${stats.unpaidAmount > 0 ? 'unpaid' : ''}">${formatCurrency(stats.unpaidAmount)}</div>
                </div>
            </div>
            <h4>Bestellhistorie:</h4>
            ${customerOrders.map(order => `
                <div class="order-history-item" id="order-${order.id}">
                    <p><strong>Datum:</strong> ${new Date(order.datum).toLocaleString('de-DE')}</p>
                    <p><strong>Status:</strong> 
                        <span class="${order.bezahlt ? 'paid' : 'unpaid'}">
                            ${order.bezahlt ? 'Bezahlt' : 'Offen'}
                        </span>
                    </p>
                    <div class="payment-section">
                        <p><strong>Gesamtbetrag:</strong> ${formatCurrency(order.gesamtbetrag)}</p>
                        <div class="payment-input-group">
                            <label>Gezahlter Betrag:</label>
                            <input 
                                type="number" 
                                class="payment-amount-input" 
                                value="${order.gezahlteBetrag || 0}"
                                min="0" 
                                max="${order.gesamtbetrag}"
                                step="0.01"
                            >
                            <button 
                                class="confirm-payment-button"
                                onclick="updatePaymentInSearch(${order.id}, this.parentElement.querySelector('.payment-amount-input').value)"
                            >
                                üí∞ Zahlung aktualisieren
                            </button>
                        </div>
                        <p class="remaining-amount ${order.offenerBetrag > 0 ? 'unpaid-amount' : 'paid-amount'}">
                            ${order.offenerBetrag > 0 
                                ? `Noch offen: ${formatCurrency(order.offenerBetrag)}` 
                                : '‚úÖ Vollst√§ndig bezahlt'}
                        </p>
                    </div>
                    <button 
                        class="show-invoice-btn"
                        onclick="showSingleInvoice(${JSON.stringify(order.bestellungen)}, '${order.kunde}', new Date('${order.datum}'), ${order.id}, ${order.storniert})"
                    >
                        üßæ Rechnung anzeigen
                    </button>
                </div>
            `).join('')}
        </div>
    `;
    
    searchResults.classList.remove('hidden');
};


// F√ºge die Suchsektion nach dem Header ein
document.querySelector('header').insertAdjacentHTML('afterend', `
    <section id="searchSection" class="section-card">
    
        <div class="search-container">
            <div class="search-box">
                <input 
                    type="text" 
                    id="mainCustomerSearch" 
                    placeholder="Kundennamen eingeben..."
                    class="search-input"
                >
                <button id="startSearch" class="search-button">
                    üîç Suchen
                </button>
                <button id="clearMainSearch" class="clear-search" title="Suche zur√ºcksetzen">
                    ‚ùå
                </button>
            </div>
        </div>
        <div id="searchResults" class="search-results hidden"></div>
    </section>
`);


// F√ºge die zugeh√∂rigen Styles hinzu
const mainSearchStyles = `
    .search-container {
        margin: 20px 0;
    }

    .search-box {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    .search-input {
        flex: 1;
        padding: 12px 15px;
        border: 2px solid var(--wood-green);
        border-radius: 8px;
        font-size: 16px;
        transition: all 0.3s ease;
    }

    .search-input:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(75, 123, 63, 0.2);
    }

    .search-button {
        background-color: var(--wood-green);
        color: white;
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .search-button:hover {
        background-color: var(--wood-green-hover);
        transform: translateY(-1px);
    }

    .search-results {
        margin-top: 20px;
        padding: 20px;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .customer-summary {
        border-left: 4px solid var(--wood-green);
        padding: 15px;
        margin: 15px 0;
        background: #f8f9fa;
        border-radius: 0 8px 8px 0;
    }

    .customer-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 15px 0;
        padding: 15px;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .stat-item {
        text-align: center;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 6px;
    }

    .stat-value {
        font-size: 1.2em;
        font-weight: bold;
        color: var(--wood-green);
    }

    .order-history-item {
        margin: 10px 0;
        padding: 15px;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .no-results {
        text-align: center;
        padding: 20px;
        color: #666;
        font-style: italic;
    }
`;

const styleElement = document.createElement('style');
styleElement.textContent = mainSearchStyles;
document.head.appendChild(styleElement);

// Implementiere die Suchfunktion
const mainSearchInput = document.getElementById('mainCustomerSearch');
const searchButton = document.getElementById('startSearch');
const clearMainSearchButton = document.getElementById('clearMainSearch');
const searchResults = document.getElementById('searchResults');

// Funktion zum Aktualisieren der Zahlung in der Suchergebnis-Ansicht
const updatePaymentInSearch = (orderId, amountPaid) => {
    const orderIndex = orderHistory.findIndex(order => order.id === orderId);
    if (orderIndex !== -1) {
        const order = orderHistory[orderIndex];
        const newAmountPaid = parseFloat(amountPaid);
        
        if (isNaN(newAmountPaid) || newAmountPaid < 0) {
            alert('Bitte geben Sie einen g√ºltigen Betrag ein.');
            return false;
        }

        // Aktualisiere die Zahlungsinformationen
        order.gezahlteBetrag = newAmountPaid;
        order.offenerBetrag = Math.max(0, order.gesamtbetrag - newAmountPaid);
        order.bezahlt = order.offenerBetrag === 0;

        // Speichere die aktualisierten Daten
        saveOrderHistory();
        
        // Aktualisiere alle relevanten Anzeigen
        updateOrderHistoryDisplay();
        searchCustomer(order.kunde); // Aktualisiere die Suchergebnisse
        return true;
    }
    return false;
};

// Event Listener f√ºr die Suche
searchButton.addEventListener('click', () => {
    const searchTerm = mainSearchInput.value.trim();
    if (searchTerm) {
        searchCustomer(searchTerm);
    }
});

mainSearchInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        const searchTerm = mainSearchInput.value.trim();
        if (searchTerm) {
            searchCustomer(searchTerm);
        }
    }
});

// Event Listener f√ºr das Zur√ºcksetzen
clearMainSearchButton.addEventListener('click', () => {
    mainSearchInput.value = '';
    searchResults.classList.add('hidden');
    searchResults.innerHTML = '';
});

// Neue Funktion f√ºr die Verkaufsanalyse
function updateSalesAnalytics() {
    const salesFilter = document.getElementById('salesFilter');
    const salesSortOption = document.getElementById('salesSortOption');
    const tbody = document.getElementById('salesAnalyticsBody');

    // Sammle Verkaufsdaten mit optimierter Berechnung
    const salesData = {};
    
    // Initialisiere zuerst alle Produkte aus pizzaPrices
    Object.entries(pizzaPrices).forEach(([pizzaType, prices]) => {
        salesData[pizzaType] = {
            product: pizzaType,
            initialStock: prices.initialStock || 100,
            quantity: 0,
            sellingPrice: prices.selling,
            purchasePrice: prices.purchase,
            revenue: 0,
            profit: 0
        };
    });

    // F√ºge dann die Verkaufsdaten hinzu
    orderHistory.forEach(order => {
        if (order.storniert) return;

        order.bestellungen.forEach(item => {
            if (!salesData[item.pizzaType]) {
                // Falls ein Produkt in der Historie ist, aber nicht mehr in pizzaPrices
                const defaultPrice = {
                    selling: item.sellingPrice,
                    purchase: item.purchasePrice,
                    initialStock: 100
                };
                
                salesData[item.pizzaType] = {
                    product: item.pizzaType,
                    initialStock: defaultPrice.initialStock,
                    quantity: 0,
                    sellingPrice: defaultPrice.selling,
                    purchasePrice: defaultPrice.purchase,
                    revenue: 0,
                    profit: 0
                };
            }

            const data = salesData[item.pizzaType];
            data.quantity += item.quantity;
            
            // Verwende die tats√§chlichen Werte aus der Bestellung
            const itemRevenue = Math.round(item.total * 100) / 100;
            const itemProfit = Math.round(item.profit * 100) / 100;
            
            data.revenue += itemRevenue;
            data.profit += itemProfit;
        });
    });

    // Filtere und sortiere wie gehabt
    let sales = Object.values(salesData);
    const filterText = salesFilter.value.toLowerCase();
    if (filterText) {
        sales = sales.filter(sale => 
            sale.product.toLowerCase().includes(filterText)
        );
    }

    const sortOption = salesSortOption.value;
    sales.sort((a, b) => {
        switch (sortOption) {
            case 'stock':
                const stockA = a.initialStock - a.quantity;
                const stockB = b.initialStock - b.quantity;
                return stockA - stockB; // Aufsteigend nach Bestand
            case 'quantity':
                return b.quantity - a.quantity;
            case 'revenue':
                return b.revenue - a.revenue;
            case 'profit':
                return b.profit - a.profit;
            default:
                return 0;
        }
    });

    // Aktualisiere Tabelle mit verbesserten Informationen
    tbody.innerHTML = sales.map(sale => {
        // Berechne den aktuellen Bestand als Summe des alten aktuellen Bestands und des neuen Anfangsbestands
        const currentStock = sale.initialStock - sale.quantity;
        const isLowStock = currentStock < 25;
        
        // Berechnung des Werts
        const value = currentStock * sale.purchasePrice;
        const abWert = sale.initialStock * sale.purchasePrice; // Korrekte Berechnung des AB Werts
        
        // Erweiterte Warnstyling f√ºr niedrige Best√§nde
        const stockWarningStyle = isLowStock ? `
            style="
                color: #dc3545; 
                font-weight: bold;
                background-color: #ffcccc;
                border-left: 3px solid #dc3545;
            "
        ` : '';
        
        // Warnsymbol f√ºr niedrige Best√§nde
        const warningIcon = isLowStock ? '‚ö†Ô∏è' : '';
        
        // Formatiere die Zahlen f√ºr bessere Lesbarkeit
        const formattedQuantity = sale.quantity.toFixed(2);
        const formattedRevenue = formatCurrency(sale.revenue);
        const formattedProfit = formatCurrency(sale.profit);
        const formattedValue = formatCurrency(value); // Formatierter Wert
        const formattedAbWert = formatCurrency(abWert); // Formatierter AB Wert
        
        // Berechne die Gewinnmarge in Prozent
        const profitMargin = sale.revenue > 0 
            ? Math.round((sale.profit / sale.revenue) * 100) 
            : 0;
        
        return `
            <tr>
                <td>${sale.product}</td>
                <td>${sale.initialStock}</td> <!-- Anfangsbestand anzeigen -->
                <td ${stockWarningStyle}>
                    ${currentStock} ${warningIcon}
                    ${isLowStock ? `
                        <div style="
                            font-size: 0.8em;
                            margin-top: 4px;
                            color: #dc3545;
                        ">
                            Nachbestellen!
                        </div>
                    ` : ''}
                </td>
                <td>${formattedQuantity}</td>
                <td title="Verkaufspreis: ${formatCurrency(sale.sellingPrice)}">${formattedRevenue}</td>
                <td title="Gewinnmarge: ${profitMargin}%">${formattedProfit}</td>
                <td>${formattedValue}</td>
                <td>${formattedAbWert}</td> <!-- Neue Zelle f√ºr den AB Wert -->
            </tr>
        `;
    }).join('');

    // F√ºge die Zusammenfassungszeile hinzu
    const totals = sales.reduce((acc, sale) => ({
        totalQuantity: acc.totalQuantity + sale.quantity,
        totalRevenue: acc.totalRevenue + sale.revenue,
        totalProfit: acc.totalProfit + sale.profit,
        totalValue: acc.totalValue + (sale.initialStock - sale.quantity) * sale.purchasePrice, // Berechnung des Gesamtwerts
        totalAbWert: acc.totalAbWert + sale.initialStock * sale.purchasePrice // Berechnung des Gesamt-AB-Werts
    }), { totalQuantity: 0, totalRevenue: 0, totalProfit: 0, totalValue: 0, totalAbWert: 0 });

    // F√ºge Zusammenfassungszeile hinzu
    tbody.innerHTML += `
        <tr style="font-weight: bold; background-color: #f8f9fa;">
            <td>Gesamt</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>${formatCurrency(totals.totalRevenue)}</td>
            <td>${formatCurrency(totals.totalProfit)}</td>
            <td>${formatCurrency(totals.totalValue)}</td> <!-- Neue Zelle f√ºr die Gesamtsumme des Werts -->
            <td>${formatCurrency(totals.totalAbWert)}</td> <!-- Neue Zelle f√ºr die Gesamtsumme des AB Werts -->
        </tr>
    `;
}

// Event Listener f√ºr Verkaufsfilter und Sortierung
document.getElementById('salesFilter').addEventListener('input', updateSalesAnalytics);
document.getElementById('salesSortOption').addEventListener('change', updateSalesAnalytics);

// Initiale Aktualisierung der Verkaufsanalyse
updateSalesAnalytics();

// Funktion zur Aktualisierung der OPOS-Anzeige
function updateOposSummary() {
    const totalUnpaidAmount = orderHistory.reduce((sum, order) => {
        // Ber√ºcksichtige nur nicht stornierte und unbezahlte Bestellungen
        if (!order.storniert && !order.bezahlt) {
            return sum + (order.offenerBetrag || 0);
        }
        return sum;
    }, 0);

    document.getElementById('totalUnpaidAmount').textContent = formatCurrency(totalUnpaidAmount);
}

// Funktion zur Aktualisierung der Zahlungsstatus-Anzeige
function updatePaymentStatusDisplay() {
    const unpaidTotal = orderHistory.reduce((sum, order) => 
        sum + (!order.bezahlt && !order.storniert ? (order.offenerBetrag || 0) : 0), 0);
    const totalOrders = orderHistory.filter(order => !order.storniert).length;
    const paidOrders = orderHistory.filter(order => order.bezahlt && !order.storniert).length;

    document.getElementById('unpaidAmount').textContent = formatCurrency(unpaidTotal);
    document.getElementById('paidOrders').textContent = `${paidOrders}/${totalOrders}`;
}

// Ersetze die bestehende updateProductRanking Funktion:

function updateProductRanking() {
    const tbody = document.getElementById('productRankingBody');
    if (!tbody) return;

    // Sammle Produktdaten
    const productData = {};
    
    // Initialisiere Produkte aus pizzaPrices
    Object.entries(pizzaPrices).forEach(([pizzaType, prices]) => {
        productData[pizzaType] = {
            name: pizzaType,
            quantity: 0,
            lastSellingPrice: prices.selling || 0,
            revenue: 0,
            profit: 0
        };
    });

    // F√ºge Verkaufsdaten aus der orderHistory hinzu
    orderHistory.forEach(order => {
        if (order.storniert) return;
        
        order.bestellungen.forEach(item => {
            const data = productData[item.pizzaType];
            if (data) {
                data.quantity += Number(item.quantity || 0);
                data.lastSellingPrice = Number(item.sellingPrice || 0);
                data.revenue += Number(item.total || 0);
                data.profit += Number(item.profit || 0);
            }
        });
    });

    // Konvertiere zu Array und sortiere nach Umsatz
    let products = Object.values(productData)
        .sort((a, b) => b.revenue - a.revenue)
        .slice(0, 10); // Top 10 Produkte

    // Aktualisiere Tabelle
    tbody.innerHTML = products.map((product, index) => {
        const rank = index + 1;
        let rankClass = 'rank-other';
        if (rank <= 3) rankClass = 'rank-top-3';
        else if (rank <= 10) rankClass = 'rank-top-10';

        // Berechne Trend basierend auf Gewinnmarge
        const margin = product.revenue > 0 ? (product.profit / product.revenue) : 0;
        let trendHtml = '';
        if (margin > 0.3) {
            trendHtml = '<div class="trend-indicator trend-up">‚Üë Steigend</div>';
        } else if (margin < 0.2) {
            trendHtml = '<div class="trend-indicator trend-down">‚Üì Fallend</div>';
        } else {
            trendHtml = '<div class="trend-indicator trend-neutral">‚Üí Stabil</div>';
        }

        return `
            <tr>
                <td>
                    <div class="rank-number ${rankClass}">${rank}</div>
                </td>
                <td>${product.name}</td>
                <td>${product.quantity.toFixed(2)}</td>
                <td>${formatCurrency(product.lastSellingPrice)}</td>
                <td>${formatCurrency(product.revenue)}</td>
                <td>${formatCurrency(product.profit)}</td>
                <td>${trendHtml}</td>
            </tr>
        `;
    }).join('');
}

// Event Listener f√ºr die initiale Aktualisierung
document.addEventListener('DOMContentLoaded', updateProductRanking);

// Event Listener f√ºr Updates bei √Ñnderungen
document.addEventListener('orderUpdated', updateProductRanking);

function berechneTrend(historischeDaten) {
    // Nehme die letzten 10 Werte
    const letzteDaten = historischeDaten.slice(-10);
    
    // Berechne die durchschnittliche √Ñnderung
    let aenderung = 0;
    for (let i = 1; i < letzteDaten.length; i++) {
        aenderung += letzteDaten[i] - letzteDaten[i-1];
    }
    
    const durchschnittlicheAenderung = aenderung / (letzteDaten.length - 1);
    
    // Bestimme den Trend
    if (durchschnittlicheAenderung > 0.2) {
        return 'steigend';
    } else if (durchschnittlicheAenderung < -0.2) {
        return 'fallend';
    }
    return 'stabil';
}

function resetData() {
    // Sichere tempor√§r die Produktdaten
    const tempProdukte = JSON.parse(localStorage.getItem('produkte')) || [];
    
    // L√∂sche alle localStorage Daten
    localStorage.clear();
    
    // Stelle die Produktdaten wieder her
    localStorage.setItem('produkte', JSON.stringify(tempProdukte));
    
    // Setze die anderen Arrays zur√ºck
    verkaufteProdukte = [];
    tagesEinnahmen = [];
    monatsEinnahmen = [];
    jahresEinnahmen = [];
    
    // Aktualisiere die Anzeigen
    updateVerkaufteProdukte();
    updateStatistiken();
    
    alert('Alle Daten wurden zur√ºckgesetzt (au√üer Produktpflege)');
}

// √úberpr√ºfen Sie, ob alle Funktionen verwendet werden
function unusedFunction() {
    // Diese Funktion wird nirgends aufgerufen
}



// F√ºge Event Listener f√ºr die Verkaufsanalyse hinzu
document.getElementById('salesFilter').addEventListener('input', () => {
    updateSalesAnalytics();
});

document.getElementById('salesSortOption').addEventListener('change', () => {
    updateSalesAnalytics();
});

// F√ºge Event Listener f√ºr die Nutzeranalyse hinzu
document.getElementById('userFilter').addEventListener('input', () => {
    updateUserAnalytics();
});

document.getElementById('userSortOption').addEventListener('change', () => {
    updateUserAnalytics();
});


// F√ºge die Event Listener im DOMContentLoaded Event hinzu
document.addEventListener('DOMContentLoaded', () => {
    

    

    // Event Listener f√ºr die Verkaufsanalyse
    const salesFilter = document.getElementById('salesFilter');
    const salesSortOption = document.getElementById('salesSortOption');

    if (salesFilter) {
        salesFilter.addEventListener('input', () => {
            requestAnimationFrame(updateSalesAnalytics);
        });
    }

    if (salesSortOption) {
        salesSortOption.addEventListener('change', () => {
            requestAnimationFrame(updateSalesAnalytics);
        });
    }

    // Event Listener f√ºr die Nutzeranalyse
    const userFilter = document.getElementById('userFilter');
    const userSortOption = document.getElementById('userSortOption');

    if (userFilter) {
        userFilter.addEventListener('input', () => {
            requestAnimationFrame(updateUserAnalytics);
        });
    }

    if (userSortOption) {
        userSortOption.addEventListener('change', () => {
            requestAnimationFrame(updateUserAnalytics);
        });
    }

    // Initiale Aktualisierung
    updateProductRanking();
    updateSalesAnalytics();
    updateUserAnalytics();
    calculateAvgOrderValue(); // F√ºge die Berechnung des durchschnittlichen Bestellwerts hinzu
});

// Funktion zur Berechnung des durchschnittlichen Bestellwerts
function calculateAvgOrderValue() {
    const validOrders = orderHistory.filter(order => !order.storniert);
    const totalValue = validOrders.reduce((sum, order) => sum + (order.total || 0), 0);
    const avgOrderValue = validOrders.length > 0 ? totalValue / validOrders.length : 0;
    
    document.querySelector('.average-item').textContent = formatCurrency(avgOrderValue);
}

// Event Listener f√ºr Updates bei √Ñnderungen
document.addEventListener('orderUpdated', () => {
    updateProductRanking();
    calculateAvgOrderValue(); // Aktualisiere den durchschnittlichen Bestellwert bei √Ñnderungen
});

// Hilfsfunktion zum Berechnen des aktuellen Bestands
function calculateCurrentStock(productName) {
    // Hole den initial Stock aus pizzaPrices
    const initialStock = pizzaPrices[productName]?.initialStock || 0;
    
    // Berechne die Gesamtverkaufsmenge aus der orderHistory
    const totalSold = orderHistory.reduce((sum, order) => {
        if (order.storniert) return sum;
        
        const productOrders = order.bestellungen.filter(item => 
            item.pizzaType === productName
        );
        
        return sum + productOrders.reduce((itemSum, item) => 
            itemSum + (item.quantity || 0), 0
        );
    }, 0);

    // Berechne den aktuellen Bestand
    return initialStock - totalSold;
}








</script>
</body>
</html>